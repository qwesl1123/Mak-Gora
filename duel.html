<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mak'Gora - Classic</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet" />

    <style>
      :root {
        --stone-dark: #1a1410;
        --stone-med: #2d2620;
        --stone-light: #4a423a;
        --gold: #ffd700;
        --gold-dark: #d4af37;
        --bronze: #cd7f32;
        --health-red: #cc3333;
        --mana-blue: #3385cc;
        --rage-red: #8b1a1a;
        --energy-yellow: #ffcc00;
        --text-light: #f4e4c1;
        --text-dark: #c9b896;
        --border-gold: #8b7355;
        --warrior-color: #C69B6D;
        --mage-color: #3FC7EB;
        --rogue-color: #FFF468;
        --druid-color: #FF7C0A;
        --warlock-color: #8788EE;
        --paladin-color: #F48CBA;
        --priest-color: #FFFFFF;
        --item-green: #1eff00;
        --item-blue: #0070dd;
        --item-purple: #a335ee;
        --item-orange: #ff8000;
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        background:
          linear-gradient(
            135deg,
            rgba(10, 8, 6, 0.55) 0%,
            rgba(10, 8, 6, 0.65) 100%
          ),
          url("/static/art/duel.webp");

        background-size: cover;
        background-position: center;
        background-attachment: fixed;

        color: var(--text-light);
        font-family: 'Crimson Text', serif;
        min-height: 100vh;
        padding: 20px;
      }


      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        background: linear-gradient(180deg, var(--stone-med) 0%, var(--stone-dark) 100%);
        border: 3px solid var(--bronze);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        margin-bottom: 20px;
        box-shadow: 
          0 0 30px rgba(255, 215, 0, 0.3),
          inset 0 2px 0 rgba(255, 215, 0, 0.2),
          inset 0 -2px 0 rgba(0, 0, 0, 0.5);
      }

      h1 {
        font-family: 'Cinzel', serif;
        font-size: 3.5rem;
        color: var(--gold);
        text-shadow: 
          0 0 20px rgba(255, 215, 0, 0.8),
          2px 2px 4px rgba(0, 0, 0, 0.8),
          0 0 40px rgba(255, 215, 0, 0.4);
        letter-spacing: 0.15em;
        margin-bottom: 10px;
      }

      .subtitle {
        font-size: 1.3rem;
        color: var(--text-dark);
        letter-spacing: 0.05em;
      }

      .status-bar {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 15px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 5px;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--border-gold);
        border-radius: 5px;
      }

      .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #888;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }

      .status-dot.connected {
        background: #44ff44;
        box-shadow: 0 0 15px rgba(68, 255, 68, 0.7);
      }

      .grid {
        display: grid;
        grid-template-columns: 400px 1fr;
        gap: 20px;
      }

      @media (max-width: 1200px) {
        .grid { grid-template-columns: 1fr; }
      }

      .panel {
        background: linear-gradient(180deg, var(--stone-med) 0%, var(--stone-dark) 100%);
        border: 3px solid var(--bronze);
        border-radius: 8px;
        box-shadow: 
          0 8px 20px rgba(0, 0, 0, 0.6),
          inset 0 2px 0 rgba(255, 215, 0, 0.15);
      }

      .panel-header {
        background: linear-gradient(180deg, var(--stone-light) 0%, var(--stone-med) 100%);
        border-bottom: 2px solid var(--bronze);
        padding: 15px 20px;
        font-family: 'Cinzel', serif;
        font-size: 1.4rem;
        color: var(--gold);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }

      .panel-body {
        padding: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.6) 100%);
        border: 2px solid var(--border-gold);
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
      }

      .stat-title {
        font-family: 'Cinzel', serif;
        font-size: 1.3rem;
        color: var(--gold-dark);
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        padding-bottom: 8px;
      }

      .stat-row {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        font-size: 1.1rem;
        color: var(--text-dark);
      }

      .stat-row strong {
        color: var(--text-light);
        font-weight: 600;
      }

      .stat-row strong.log-item-green {
        color: var(--item-green);
      }

      .stat-row strong.log-item-blue {
        color: var(--item-blue);
      }

      .stat-row strong.log-item-purple {
        color: var(--item-purple);
      }

      .stat-row strong.log-item-orange {
        color: var(--item-orange);
      }

      .stat-row strong .fx.fx_thunderfury,
      .stat-row strong .fx.fx_dragonwrath {
        display: inline;
        white-space: normal;
      }

      .status-text {
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .status-text.stealthed {
        color: var(--rogue-color);
      }

      .status-text.warrior {
        color: var(--warrior-color);
      }

      .status-text.mage {
        color: var(--mage-color);
      }

      .status-text.rogue {
        color: var(--rogue-color);
      }

      .status-text.druid {
        color: var(--druid-color);
      }

      .status-text.warlock {
        color: var(--warlock-color);
      }

      .status-text.paladin {
        color: var(--paladin-color);
      }

      .status-text.priest {
        color: var(--priest-color);
      }

      .resource-bar {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 8px 0;
      }

      .bar-container {
        flex: 1;
        height: 20px;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid var(--border-gold);
        border-radius: 3px;
        overflow: hidden;
        position: relative;
        display: flex;
      }

      .bar-fill {
        height: 100%;
        transition: width 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .bar-fill.health {
        background: linear-gradient(180deg, #ff4444 0%, #cc0000 100%);
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
      }

      .bar-fill.health.hp-dead {
        background: #000;
        box-shadow: none;
      }

      .bar-fill.absorb {
        background: #ffffff;
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.6);
      }

      .bar-fill.mana {
        background: linear-gradient(180deg, #4488ff 0%, #0044cc 100%);
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
      }

      .bar-fill.energy {
        background: linear-gradient(180deg, #ffff44 0%, #cccc00 100%);
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
      }

      .bar-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.85rem;
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        z-index: 1;
        width: 100%;
        text-align: center;
      }

      button {
        background: linear-gradient(180deg, var(--stone-light) 0%, var(--stone-med) 100%);
        border: 2px solid var(--bronze);
        color: var(--text-light);
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Crimson Text', serif;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        box-shadow: 
          0 4px 8px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 215, 0, 0.2);
      }

      button:hover {
        background: linear-gradient(180deg, #5a5248 0%, var(--stone-light) 100%);
        border-color: var(--gold-dark);
        transform: translateY(-2px);
        box-shadow: 
          0 6px 12px rgba(0, 0, 0, 0.5),
          0 0 20px rgba(255, 215, 0, 0.3);
      }

      button:active {
        transform: translateY(0);
      }

      .btn-primary {
        background: linear-gradient(180deg, var(--gold-dark) 0%, var(--bronze) 100%);
        border-color: var(--gold);
        color: var(--stone-dark);
      }

      .btn-primary:hover {
        background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dark) 100%);
        box-shadow: 
          0 6px 12px rgba(0, 0, 0, 0.5),
          0 0 25px rgba(255, 215, 0, 0.6);
      }

      input[type="text"] {
        width: 100%;
        padding: 12px 15px;
        background: rgba(0, 0, 0, 0.5);
        border: 2px solid var(--border-gold);
        border-radius: 5px;
        color: var(--text-light);
        font-family: 'Crimson Text', serif;
        font-size: 1.1rem;
        outline: none;
      }

      input[type="text"]:focus {
        border-color: var(--gold-dark);
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
      }

      .combat-log {
        background: rgba(0, 0, 0, 0.6);
        border: 2px solid var(--border-gold);
        border-radius: 6px;
        height: 750px;
        overflow-y: auto;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 0.95rem;
        line-height: 1.6;
      }

      .combat-log::-webkit-scrollbar {
        width: 12px;
      }

      .combat-log::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 6px;
      }

      .combat-log::-webkit-scrollbar-thumb {
        background: var(--bronze);
        border-radius: 6px;
        border: 2px solid rgba(0, 0, 0, 0.5);
      }

      .post-log-row {
        display: grid;
        grid-template-columns: 240px 1fr;
        gap: 16px;
        margin-top: 16px;
        align-items: start;
      }

      .cooldown-section {
        background: rgba(0, 0, 0, 0.55);
        border: 2px solid var(--border-gold);
        border-radius: 6px;
        padding: 10px;
      }

      .cooldown-title {
        font-family: 'Cinzel', serif;
        font-size: 0.95rem;
        color: var(--gold-dark);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-bottom: 8px;
      }

      .cooldown-list {
        display: grid;
        gap: 6px;
      }

      .cooldown-entry {
        font-size: 0.95rem;
        color: var(--text-light);
      }

      .cooldown-empty {
        color: var(--text-dark);
        font-style: italic;
      }

      /* Chat Section */
      .chat-section {
        margin-top: 0;
      }

      .chat-header {
        font-family: 'Cinzel', serif;
        font-size: 1.1rem;
        color: var(--gold-dark);
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .chat-box {
        background: rgba(0, 0, 0, 0.7);
        border: 3px solid #44ff44;
        border-radius: 6px;
        height: 300px;
        overflow-y: auto;
        padding: 12px;
        font-family: 'Arial', sans-serif;
        font-size: 1rem;
        line-height: 1.5;
        box-shadow: 
          0 0 20px rgba(68, 255, 68, 0.3),
          inset 0 0 10px rgba(68, 255, 68, 0.1);
      }

      .chat-box::-webkit-scrollbar {
        width: 10px;
      }

      .chat-box::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 5px;
      }

      .chat-box::-webkit-scrollbar-thumb {
        background: #44ff44;
        border-radius: 5px;
        border: 2px solid rgba(0, 0, 0, 0.5);
      }

      .chat-message {
        margin-bottom: 8px;
        padding: 4px 0;
      }

      .chat-message.friendly {
        color: #44ff44;
      }

      .chat-message.enemy {
        color: #ff4444;
      }

      .chat-message .chat-player {
        font-weight: bold;
        margin-right: 8px;
      }

      .chat-input-group {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        margin-top: 10px;
      }

      .chat-input-group input {
        padding: 10px 12px;
        font-size: 1rem;
      }

      .chat-input-group button {
        padding: 10px 20px;
      }

      .log-line {
        margin-bottom: 6px;
        padding: 3px 0;
      }

      .logLineSystem {
        color: var(--gold-dark);
      }

      .logLineTurn {
        color: #ffaa44;
      }

      .logLineTurnHeader {
        color: #ffffff;
        font-size: 1.4em;
        font-weight: 700;
        text-shadow: 0 0 12px rgba(255, 255, 255, 0.85);
      }

      .logLineProc {
        color: var(--gold);
        font-weight: 700;
        text-shadow: 0 0 12px rgba(255, 215, 0, 0.8);
      }

      .logLineAmbush {
        color: var(--rogue-color);
        font-weight: 700;
        text-shadow: 0 0 12px rgba(255, 244, 104, 0.95);
      }

      .logLinePaladinProc {
        color: var(--paladin-color);
        font-weight: 700;
        text-shadow: 0 0 12px rgba(244, 140, 186, 0.95);
      }

      .logLineExecute {
        color: #ff4444;
        font-weight: 700;
        text-shadow: 0 0 12px rgba(255, 68, 68, 0.85);
      }

      .logLinePriestGlow {
        color: #FFFFFF;
        font-weight: 700;
        text-shadow: 0 0 12px rgba(255, 255, 255, 0.95);
      }

      .logLineOutcome {
        font-size: 2em;
        font-weight: 700;
        text-shadow: 0 0 12px rgba(255, 255, 255, 0.7);
      }

      .logLineChat {
        color: #88ddff;
      }

      .log-summary {
        display: grid;
        gap: 6px;
        margin: 6px 0;
      }

      .log-summary-title {
        font-weight: 700;
        color: #ffffff;
      }

      .log-summary-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 32px;
        white-space: nowrap;
      }

      .log-summary-damage {
        color: #ff4444;
        font-weight: 700;
      }

      .log-summary-heal {
        color: #44dd66;
        font-weight: 700;
      }

      .log-class-warrior,
      .log-ability-warrior {
        color: var(--warrior-color);
        font-weight: 700;
      }

      .log-class-mage,
      .log-ability-mage {
        color: var(--mage-color);
        font-weight: 700;
      }

      .log-class-rogue,
      .log-ability-rogue {
        color: var(--rogue-color);
        font-weight: 700;
      }

      .log-ability-azzinoth {
        color: #1EFF00;
        font-weight: 700;
      }

      .log-class-druid,
      .log-ability-druid {
        color: var(--druid-color);
        font-weight: 700;
      }

      .log-class-warlock,
      .log-ability-warlock {
        color: var(--warlock-color);
        font-weight: 700;
      }

      .log-class-paladin,
      .log-ability-paladin {
        color: var(--paladin-color);
        font-weight: 700;
      }

      .log-class-priest,
      .log-ability-priest {
        color: var(--priest-color);
        font-weight: 700;
      }

      .log-item-green {
        color: var(--item-green);
        font-weight: 700;
      }

      .log-item-blue {
        color: var(--item-blue);
        font-weight: 700;
      }

      .log-item-purple {
        color: var(--item-purple);
        font-weight: 700;
      }

      .log-item-orange {
        color: var(--item-orange);
        font-weight: 700;
      }

      .controls {
        display: grid;
        gap: 10px;
        margin-top: 15px;
      }

      .input-group {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
      }

      .hint {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--border-gold);
        border-radius: 5px;
        padding: 15px;
        margin-top: 15px;
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--text-dark);
      }

      .kbd {
        display: inline-block;
        padding: 3px 8px;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid var(--bronze);
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        color: var(--gold);
      }

      /* Documentation Section */
      .documentation {
        max-width: 1400px;
        margin: 40px auto;
        background: linear-gradient(180deg, var(--stone-med) 0%, var(--stone-dark) 100%);
        border: 3px solid var(--bronze);
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      }

      .doc-title {
        font-family: 'Cinzel', serif;
        font-size: 2.5rem;
        color: var(--gold);
        text-align: center;
        margin-bottom: 30px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }

      .doc-section {
        margin-bottom: 30px;
      }

      .doc-section h3 {
        font-family: 'Cinzel', serif;
        font-size: 1.8rem;
        color: var(--gold-dark);
        margin-bottom: 15px;
        border-bottom: 2px solid var(--bronze);
        padding-bottom: 10px;
      }

      .doc-subtitle {
        font-family: 'Cinzel', serif;
        font-size: 1.4rem;
        color: var(--text-light);
        margin-top: 20px;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .doc-content {
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--text-light);
      }

      .doc-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 15px;
      }

      .doc-item {
        background: rgba(0, 0, 0, 0.4);
        border: 2px solid var(--border-gold);
        border-radius: 6px;
        padding: 15px;
      }

      .doc-item h4 {
        color: var(--gold);
        font-size: 1.3rem;
        margin-bottom: 10px;
        font-family: 'Cinzel', serif;
      }

      .doc-item p {
        color: var(--text-dark);
        font-size: 1rem;
        line-height: 1.6;
      }

      .doc-item .stat {
        color: var(--text-light);
        font-weight: bold;
      }


      .fx.fx_thunderfury {
        position: relative;
        display: inline-block;
        white-space: nowrap;
        color: inherit;
      }

      /*
       * Keep the legendary text in its own plain span so it renders exactly like
       * other .log-item-orange entries; lightning is drawn in a separate overlay.
       */
      .fx.fx_thunderfury .fx-thunderfury-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .fx.fx_thunderfury .bolt-inner {
        position: absolute;
        /* Align the lightning SVG to the exact text box; negative inset shifted it upward. */
        inset: 0;
        pointer-events: none;
        opacity: 0;
        mix-blend-mode: screen;
      }

      .fx.fx_thunderfury.is-zapped .bolt-inner {
        animation: boltFade 450ms ease-out forwards;
      }

      .fx.fx_thunderfury .inner-glow {
        fill: none;
        stroke: rgba(80, 160, 255, 0.8);
        stroke-width: 5;
        stroke-linecap: round;
        stroke-linejoin: miter;
        stroke-miterlimit: 10;
        filter: url(#blueGlow);
        opacity: 0;
      }

      .fx.fx_thunderfury .inner-path {
        fill: none;
        stroke: rgba(255, 255, 255, 1);
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: miter;
        stroke-miterlimit: 10;
        filter: url(#boltGlowInner);
        opacity: 0;
      }

      .fx.fx_thunderfury.is-zapped .inner-glow,
      .fx.fx_thunderfury.is-zapped .inner-path {
        opacity: 1;
        animation: boltDraw 120ms ease-out forwards, boltFlicker 450ms steps(1, end) forwards;
      }



      .fx.fx_dragonwrath {
        position: relative;
        display: inline-block;
        white-space: nowrap;
        color: inherit;
      }

      .fx.fx_dragonwrath .arcane-container {
        position: absolute;
        inset: -20px;
        pointer-events: none;
        overflow: visible;
      }

      .fx.fx_dragonwrath .arcane-orb {
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(180, 230, 255, 1) 0%, rgba(100, 200, 255, 0.9) 30%, rgba(80, 180, 255, 0) 100%);
        box-shadow: 0 0 6px rgba(120, 210, 255, 0.9), 0 0 12px rgba(100, 200, 255, 0.6), 0 0 18px rgba(80, 180, 255, 0.4);
        opacity: 1;
        transform: translate(-50%, -50%);
      }

      .fx.fx_dragonwrath .arcane-orb::before {
        content: "";
        position: absolute;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(150, 220, 255, 0.6);
        box-shadow: 0 0 10px rgba(120, 210, 255, 0.8), 0 0 20px rgba(100, 200, 255, 0.6), 0 0 30px rgba(80, 180, 255, 0.4);
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        opacity: 0.9;
        pointer-events: none;
      }

      .fx.fx_dragonwrath .arcane-trail {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        opacity: 0.6;
        overflow: visible;
      }

      .fx.fx_dragonwrath .trail-segment {
        fill: none;
        stroke: rgba(150, 220, 255, 0.8);
        stroke-width: 3;
        stroke-linecap: round;
        filter: url(#dragonwrathArcaneGlow);
      }

      .fx.fx_dragonwrath.fx_dragonwrath-log .arcane-container {
        inset: -12px;
      }

      .fx.fx_dragonwrath.fx_dragonwrath-log .arcane-orb {
        width: 4.5px;
        height: 4.5px;
      }

      .fx.fx_dragonwrath.fx_dragonwrath-log .arcane-orb::before {
        width: 9px;
        height: 9px;
      }

      .fx.fx_dragonwrath.fx_dragonwrath-log .trail-segment {
        stroke-width: 2.25;
      }

      .fx.fx_twin_blades_azzinoth {
        position: relative;
        display: inline-block;
        white-space: nowrap;
        color: inherit;
      }

      .fx.fx_twin_blades_azzinoth .slash-container {
        position: absolute;
        inset: -24px;
        pointer-events: none;
        overflow: visible;
      }

      .fx.fx_twin_blades_azzinoth .slash-svg {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: visible;
      }

      .fx.fx_twin_blades_azzinoth .slash-path {
        fill: none;
        stroke: url(#bladeGradient);
        stroke-width: 1;
        stroke-linecap: round;
        filter: url(#felSlashGlow);
        opacity: 0;
      }

      .fx.fx_twin_blades_azzinoth .slash-path.slashing {
        animation: slashAppear 1s ease-out forwards;
      }

      @keyframes slashAppear {
        0% { stroke-dashoffset: var(--length, 1000); opacity: 0; stroke-width: 1; }
        10% { opacity: 1; stroke-width: 4; }
        14% { stroke-dashoffset: 0; opacity: 1; stroke-width: 6; }
        30% { stroke-width: 1; opacity: 0.5; }
        100% { stroke-dashoffset: 0; opacity: 0; stroke-width: 1; }
      }
      @keyframes boltDraw {
        from { stroke-dashoffset: var(--dash, 1000); }
        to { stroke-dashoffset: 0; }
      }

      @keyframes boltFlicker {
        0% { opacity: 0; }
        5% { opacity: 1; }
        12% { opacity: 0.3; }
        18% { opacity: 1; }
        25% { opacity: 0.4; }
        32% { opacity: 1; }
        45% { opacity: 0.2; }
        58% { opacity: 0.8; }
        70% { opacity: 0; }
        100% { opacity: 0; }
      }

      @keyframes boltFade {
        0% { opacity: 0; }
        4% { opacity: 1; }
        65% { opacity: 0.6; }
        100% { opacity: 0; }
      }

      @keyframes glowCycle {
        0% { opacity: 0; }
        6% { opacity: 1; }
        12% { opacity: 0; }
        18% { opacity: 1; }
        24% { opacity: 0; }
        49% { opacity: 0; }
        55% { opacity: 1; }
        61% { opacity: 0; }
        67% { opacity: 1; }
        73% { opacity: 0; }
        100% { opacity: 0; }
      }
    </style>
  </head>

  <body>
    <svg width="0" height="0" style="position:absolute" aria-hidden="true" focusable="false">
    <defs>
      <!-- Blade color gradient for Twin Blades of Azzinoth slashes -->
      <linearGradient id="bladeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:rgba(80, 255, 80, 0);stop-opacity:0" />
        <stop offset="15%" style="stop-color:rgba(80, 255, 80, 1);stop-opacity:1" />
        <stop offset="50%" style="stop-color:rgba(120, 255, 120, 1);stop-opacity:1" />
        <stop offset="85%" style="stop-color:rgba(80, 255, 80, 1);stop-opacity:1" />
        <stop offset="100%" style="stop-color:rgba(80, 255, 80, 0);stop-opacity:0" />
      </linearGradient>
    </defs>

      <filter id="boltGlowInner" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur stdDeviation="0.8" result="b1" />
        <feGaussianBlur stdDeviation="2" result="b2" />
        <feGaussianBlur stdDeviation="4" result="b3" />
        <feMerge>
          <feMergeNode in="b3" />
          <feMergeNode in="b2" />
          <feMergeNode in="b1" />
          <feMergeNode in="SourceGraphic" />
        </feMerge>
      </filter>
      <filter id="blueGlow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur stdDeviation="3" result="g1" />
        <feGaussianBlur stdDeviation="6" result="g2" />
        <feGaussianBlur stdDeviation="10" result="g3" />
        <feMerge>
          <feMergeNode in="g3" />
          <feMergeNode in="g2" />
          <feMergeNode in="g1" />
          <feMergeNode in="SourceGraphic" />
        </feMerge>
      </filter>
      <filter id="dragonwrathArcaneGlow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur stdDeviation="2" result="dragonBlur1" />
        <feGaussianBlur stdDeviation="4" result="dragonBlur2" />
        <feGaussianBlur stdDeviation="6" result="dragonBlur3" />
        <feMerge>
          <feMergeNode in="dragonBlur3" />
          <feMergeNode in="dragonBlur2" />
          <feMergeNode in="dragonBlur1" />
          <feMergeNode in="SourceGraphic" />
        </feMerge>
      </filter>
      <filter id="felSlashGlow" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur stdDeviation="1.5" result="blur1" />
        <feGaussianBlur stdDeviation="3" result="blur2" />
        <feColorMatrix in="blur2" type="matrix" values="
          0 0 0 0 0.2
          0 0 0 0 1
          0 0 0 0 0.2
          0 0 0 0.9 0
        " result="green2" />
        <feColorMatrix in="blur1" type="matrix" values="
          0 0 0 0 0.4
          0 0 0 0 1
          0 0 0 0 0.4
          0 0 0 0.7 0
        " result="green1" />
        <feMerge>
          <feMergeNode in="green2" />
          <feMergeNode in="green1" />
          <feMergeNode in="SourceGraphic" />
        </feMerge>
      </filter>
    </svg>

    <div class="container">
      <div class="header">
        <a href="/" style="display:inline-block; margin-bottom:15px; color: var(--gold); text-decoration: none; font-size: 1.1rem; transition: color 0.3s;">
          ← Return to Main Hub
        </a>
        <h1>Mak'Gora</h1>
        <div class="subtitle">Trial by Combat - Turn-Based PvP</div>
        <div class="status-bar">
          <div class="status-indicator">
            <span id="connDot" class="status-dot"></span>
            <span id="connText">Disconnected</span>
          </div>
          <div class="status-indicator">
            <span id="roleText">Awaiting Match</span>
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- Left Panel: Controls & Stats -->
        <div class="panel">
          <div class="panel-header">War Council</div>
          <div class="panel-body">
            <!-- Friendly Stats -->
            <div class="stat-card">
              <h3 class="stat-title" id="friendlyLabel">Friendly Champion</h3>
              <div class="stat-row"><span>Weapon:</span><strong id="friendlyWeapon">--</strong></div>
              <div class="stat-row"><span>Armor:</span><strong id="friendlyArmor">--</strong></div>
              <div class="stat-row"><span>Trinket:</span><strong id="friendlyTrinket">--</strong></div>
              <div class="stat-row"><span>Status:</span><strong id="friendlyStatus" class="status-text">--</strong></div>
              
              <div class="resource-bar">
                <span style="width: 60px; color: var(--health-red); font-weight: bold;">HP</span>
                <div class="bar-container">
                  <div class="bar-text" id="friendlyHpText">--</div>
                  <div class="bar-fill health" id="friendlyHpBar" style="width: 100%;"></div>
                  <div class="bar-fill absorb" id="friendlyAbsorbBar" style="width: 0%;"></div>
                </div>
              </div>
              
              <div class="resource-bar">
                <span id="friendlyPrimaryLabel" style="width: 60px; color: var(--mana-blue); font-weight: bold;">Mana</span>
                <div class="bar-container">
                  <div class="bar-text" id="friendlyPrimaryText">--</div>
                  <div class="bar-fill" id="friendlyPrimaryBar" style="width: 100%;"></div>
                </div>
              </div>
              
            </div>

            <!-- Enemy Stats -->
            <div class="stat-card">
              <h3 class="stat-title" id="enemyLabel">Enemy Champion</h3>
              <div class="stat-row"><span>Weapon:</span><strong id="enemyWeapon">--</strong></div>
              <div class="stat-row"><span>Armor:</span><strong id="enemyArmor">--</strong></div>
              <div class="stat-row"><span>Trinket:</span><strong id="enemyTrinket">--</strong></div>
              <div class="stat-row"><span>Status:</span><strong id="enemyStatus" class="status-text">--</strong></div>
              
              <div class="resource-bar">
                <span style="width: 60px; color: var(--health-red); font-weight: bold;">HP</span>
                <div class="bar-container">
                  <div class="bar-text" id="enemyHpText">--</div>
                  <div class="bar-fill health" id="enemyHpBar" style="width: 100%;"></div>
                  <div class="bar-fill absorb" id="enemyAbsorbBar" style="width: 0%;"></div>
                </div>
              </div>
              
              <div class="resource-bar">
                <span id="enemyPrimaryLabel" style="width: 60px; color: var(--mana-blue); font-weight: bold;">Mana</span>
                <div class="bar-container">
                  <div class="bar-text" id="enemyPrimaryText">--</div>
                  <div class="bar-fill" id="enemyPrimaryBar" style="width: 100%;"></div>
                </div>
              </div>
              
            </div>

            <div class="controls">
              <button class="btn-primary" id="queueBtn">Enter the Arena</button>
              <button class="btn-primary" id="lockBtn">Lock In</button>
              <button id="passBtn">Pass Turn</button>
              
              <div class="input-group">
                <input id="commandInput" type="text" placeholder="Enter command..." autocomplete="off" />
                <button id="sendBtn">Execute</button>
              </div>
            </div>

            <div class="hint">
              <strong>Commands:</strong><br>
              <span class="kbd">/class warrior</span>, <span class="kbd">/class mage</span>, <span class="kbd">/class rogue</span>, or <span class="kbd">/class warlock</span>, or <span class="kbd">/class priest</span> - Choose your class<br>
              <span class="kbd">/item weapon steel_long_sword</span> - Equip weapon<br>
              <span class="kbd">/item armor leather_armor</span> - Equip armor<br>
              <span class="kbd">basic_attack</span>, <span class="kbd">fireball</span>, <span class="kbd">eviscerate</span>, <span class="kbd">blink</span>, <span class="kbd">cheap_shot</span> - Combat abilities<br>
              <br>
              <strong>Chat:</strong> Use the Chat box below to message your opponent
            </div>
          </div>
        </div>

        <!-- Right Panel: Combat Log & Chat -->
        <div class="panel">
          <div class="panel-header">Combat Chronicle</div>
          <div class="panel-body">
            <div id="log" class="combat-log"></div>
            
            <div class="post-log-row">
              <div class="cooldown-section">
                <div class="cooldown-title">Cooldown Tracker</div>
                <div id="cooldownTracker" class="cooldown-list">
                  <div class="cooldown-empty">No cooldowns active.</div>
                </div>
              </div>

              <!-- Chat Section -->
              <div class="chat-section">
                <div class="chat-header">Chat</div>
                <div id="chatBox" class="chat-box"></div>
                <div class="chat-input-group">
                  <input id="chatInput" type="text" placeholder="Type your message..." autocomplete="off" />
                  <button id="chatSendBtn">Send</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Documentation -->
    <div class="documentation">
      <h2 class="doc-title">Champion's Codex</h2>

      <div class="doc-section">
        <h3>Classes</h3>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Warrior</h4>
            <p><span class="stat">Attack: 12</span> | <span class="stat">Intellect: 2</span> | <span class="stat">Defense: 8</span></p>
            <p><span class="stat">HP: 110</span> | Speed: 8 | Crit: 5% | Accuracy: 90%</p>
            <p>Master of physical combat. Excels at melee attacks and tanking damage. High HP and physical damage output.</p>
          </div>
          
          <div class="doc-item">
            <h4>Mage</h4>
            <p><span class="stat">Attack: 4</span> | <span class="stat">Intellect: 14</span> | <span class="stat">Defense: 4</span></p>
            <p><span class="stat">HP: 90</span> | <span class="stat">Mana: 80</span> | Speed: 9 | Crit: 8% | Accuracy: 95%</p>
            <p>Master of arcane magic. Weak physical attacks but devastating spells. Uses Mana for powerful abilities.</p>
          </div>

          <div class="doc-item">
            <h4>Rogue</h4>
            <p><span class="stat">Attack: 10</span> | <span class="stat">Intellect: 1</span> | <span class="stat">Defense: 4</span></p>
            <p><span class="stat">HP: 95</span> | <span class="stat">Energy: 100</span> | Speed: 9 | Crit: 8% | Accuracy: 97%</p>
            <p>Elusive striker with exceptional evasion. Uses Energy and excels at stealthy burst damage.</p>
          </div>

          <div class="doc-item">
            <h4>Druid</h4>
            <p><span class="stat">Attack: 6</span> | <span class="stat">Intellect: 6</span> | <span class="stat">Defense: 5</span></p>
            <p><span class="stat">HP: 100</span> | <span class="stat">Mana: 80</span> | <span class="stat">Energy: 100</span> | Speed: 8 | Crit: 8% | Accuracy: 95%</p>
            <p>Adaptive shapeshifter. Switches forms to access different resources and roles.</p>
          </div>

          <div class="doc-item">
            <h4>Warlock</h4>
            <p><span class="stat">Attack: 3</span> | <span class="stat">Intellect: 15</span> | <span class="stat">Defense: 7</span></p>
            <p><span class="stat">HP: 110</span> | <span class="stat">Mana: 100</span> | Speed: 9 | Crit: 4% | Accuracy: 96%</p>
            <p>Master of curses and demons. Uses Mana only and specializes in magical afflictions.</p>
          </div>

          <div class="doc-item">
            <h4>Paladin</h4>
            <p><span class="stat">Attack: 10</span> | <span class="stat">Intellect: 7</span> | <span class="stat">Defense: 6</span></p>
            <p><span class="stat">HP: 100</span> | <span class="stat">Mana: 70</span> | Speed: 7 | Crit: 5% | Accuracy: 90%</p>
            <p>Holy warrior of the Light. Mixes weapon strikes, shielding, and support magic for balanced offense and defense.</p>
          </div>

          <div class="doc-item">
            <h4>Priest</h4>
            <p><span class="stat">Attack: 3</span> | <span class="stat">Intellect: 12</span> | <span class="stat">Defense: 5</span></p>
            <p><span class="stat">HP: 95</span> | <span class="stat">Mana: 110</span> | Speed: 8 | Crit: 7% | Accuracy: 95%</p>
            <p>Faith-driven spellcaster. Balances direct holy casts, shadow damage-over-time pressure, and powerful healing to outlast foes.</p>
          </div>

        </div>
      </div>

      <div class="doc-section">
        <h3>Weapons</h3>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Steel Long Sword</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon steel_long_sword</span></span></p>
            <p><span class="stat">+5 Physical Attack</span></p>
            <p>A reliable blade forged in the fires of war. Ideal for Warriors.</p>
          </div>

          <div class="doc-item">
            <h4>Crusader's Greatsword</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon crusaders_greatsword</span></span></p>
            <p><span class="stat">+4 Physical Attack</span> | <span class="stat">+2 Intellect</span></p>
            <p><span class="stat">Passive: 25% chance on hit to empower your next offensive ability (+20% damage)</span></p>
            <p>An epic blade that channels righteous fury into your next strike.</p>
          </div>
          
          <div class="doc-item">
            <h4>Spirit Light Sword</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon spirit_light_sword</span></span></p>
            <p><span class="stat">+3 Physical Attack</span></p>
            <p><span class="stat">Passive: Heal 3 HP every turn</span></p>
            <p>Blessed by the Light. Provides sustain through regeneration.</p>
          </div>
          
          <div class="doc-item">
            <h4>Wand of Fire</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon wand_of_fire</span></span></p>
            <p><span class="stat">+6 Intellect</span></p>
            <p><span class="stat">Passive: Burn enemy for 2 HP/turn on hit</span></p>
            <p>Channels destructive flames. Burns enemies with every spell cast.</p>
          </div>
          
          <div class="doc-item">
            <h4>Staff of Immortality</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon staff_of_immortality</span></span></p>
            <p><span class="stat">+3 Intellect</span></p>
            <p><span class="stat">Passive: Heal 4 HP every turn</span></p>
            <p>Ancient artifact of life magic. Grants powerful regeneration.</p>
          </div>

          <div class="doc-item">
            <h4>Steel Daggers</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon steel_daggers</span></span></p>
            <p><span class="stat">+4 Physical Attack</span></p>
            <p><span class="stat">Passive: 25% chance to strike again for 40% damage</span></p>
            <p>Swift blades favored by rogues. Occasionally delivers a second strike.</p>
          </div>

          <div class="doc-item">
            <h4>Spear of Light</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon spear_of_light</span></span></p>
            <p><span class="stat">+3 Physical Attack</span> | <span class="stat">+3 Intellect</span></p>
            <p><span class="stat">Magic Resist: 2</span></p>
            <p>A radiant spear that balances martial prowess with arcane protection.</p>
          </div>

          <div class="doc-item">
            <h4>Void Blades</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon void_blades</span></span></p>
            <p><span class="stat">+3 Physical Attack</span> | <span class="stat">+2 Intellect</span></p>
            <p><span class="stat">Passive: Void Blade triggers extra magic damage (Intellect x0.4 + d4)</span></p>
            <p>Blades attuned to the abyss, calling forth void energy on successful hits.</p>
          </div>

          <div class="doc-item">
            <h4>Thunderfury, Blessed Blade of the Windseeker</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon thunderfury</span></span></p>
            <p><span class="stat">+8 Physical Attack</span> | <span class="stat">Magic Resist: 1</span></p>
            <p><span class="stat">Passive: 25% chance on hit to blast the enemy with lightning (Attack x0.5 + d3 magic damage)</span></p>
            <p><span class="stat">Passive: 25% chance on hit to heal yourself (Attack x0.5 + d3 HP)</span></p>
            <p>A legendary blade crackling with storms that punish foes and bolster its wielder.</p>
          </div>

          <div class="doc-item">
            <h4>Dragonwrath, Tarecgosa's Rest</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon dragonwrath</span></span></p>
            <p><span class="stat">+7 Intellect</span></p>
            <p><span class="stat">Passive: 20% chance on hit to duplicate offensive spells</span></p>
            <p>Example: Arcane Barrage deals 3 hits, then Dragonwrath may duplicate the full spell for 3 additional hits.</p>
          </div>

          <div class="doc-item">
            <h4>Twin Blades of Azzinoth</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon twin_blades_azzinoth</span></span></p>
            <p><span class="stat">+7 Physical Attack</span></p>
            <p><span class="stat">Passive: 30% chance on successful damaging hit to strike again for 40% of the hit damage</span></p>
            <p><span class="stat">Active: <span class="kbd">fury_of_azzinoth</span> — 4 strikes (Attack x0.2 + d6 each), heal for total damage dealt.</span></p>
          </div>

          <div class="doc-item">
            <h4>Glock 19</h4>
            <p><span class="stat">Command: <span class="kbd">/item weapon glock_19</span></span></p>
            <p><span class="stat">+17 Physical Attack</span></p>
            <p><span class="stat">Passive: 55% chance to miss</span></p>
            <p>A risky firearm with devastating potential. High damage, but with a cost...</p>
          </div>

        </div>
      </div>

      <div class="doc-section">
        <h3>Armor</h3>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Leather Armor</h4>
            <p><span class="stat">Command: <span class="kbd">/item armor leather_armor</span></span></p>
            <p><span class="stat">Physical Reduction: 3</span></p>
            <p><span class="stat">Magic Resist: 3</span></p>
            <p>Flexible protection. Reduces damage from all sources. Balanced defense.</p>
          </div>

          <div class="doc-item">
            <h4>Cloth Armor</h4>
            <p><span class="stat">Command: <span class="kbd">/item armor cloth_armor</span></span></p>
            <p><span class="stat">Physical Reduction: 1</span></p>
            <p><span class="stat">Magic Resist: 5</span></p>
            <p>Lightweight cloth with strong enchantments. Great against spell damage.</p>
          </div>
          
          <div class="doc-item">
            <h4>Plate Armor</h4>
            <p><span class="stat">Command: <span class="kbd">/item armor plate_armor</span></span></p>
            <p><span class="stat">Physical Reduction: 6</span></p>
            <p><span class="stat">Magic Resist: 0</span></p>
            <p>Heavy steel plating. Exceptional physical protection but vulnerable to magic.</p>
          </div>

        </div>
      </div>

      <div class="doc-section">
        <h3>Trinkets</h3>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Focus Charm</h4>
            <p><span class="stat">Command: <span class="kbd">/item trinket focus_charm</span></span></p>
            <p><span class="stat">+10 Mana</span></p>
            <p><span class="stat">Passive: Deal 10% more damage while above 70% HP</span></p>
            <p>Channel a steady focus to amplify spell and weapon damage.</p>
          </div>

          <div class="doc-item">
            <h4>Rage Crystal</h4>
            <p><span class="stat">Command: <span class="kbd">/item trinket rage_crystal</span></span></p>
            <p><span class="stat">+20 Rage</span></p>
            <p><span class="stat">Passive: Deal 15% more damage while below 30% HP</span></p>
            <p>A volatile crystal that empowers desperate finishing blows.</p>
          </div>

        </div>
      </div>

      <div class="doc-section">
        <h3>Abilities</h3>
        <h4 class="doc-subtitle">General</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Basic Attack</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Type: Physical</span></p>
            <p><span class="stat">Command: <span class="kbd">basic_attack</span></span></p>
            <p>Standard melee attack. Damage scales with Attack stat. Roll d4 for power.</p>
          </div>

        </div>

        <h4 class="doc-subtitle">Warrior</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Overpower</h4>
            <p><span class="stat">Cost: 0 Rage</span> | <span class="stat">Type: Physical</span> | <span class="stat">Cooldown: 1</span></p>
            <p><span class="stat">Command: <span class="kbd">overpower</span></span></p>
            <p>Weapon strike that scales with Attack (0.6x) and d4 power. Generates Rage equal to damage dealt.</p>
          </div>

          <div class="doc-item">
            <h4>Victory Rush</h4>
            <p><span class="stat">Cost: 0 Rage</span> | <span class="stat">Type: Physical</span> | <span class="stat">Cooldown: 20 (2 charges)</span></p>
            <p><span class="stat">Command: <span class="kbd">victory_rush</span></span></p>
            <p>Quick strike that scales with Attack (0.5x) and d2 power. Heals for Attack (1.6x) and d8 power on hit and generates 5 Rage.</p>
          </div>

          <div class="doc-item">
            <h4>Rampage</h4>
            <p><span class="stat">Cost: 15 Rage</span> | <span class="stat">Type: Physical</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">rampage</span></span></p>
            <p>Rapidly strike twice. Each hit scales with Attack (0.7x) and d4 power.</p>
          </div>

          <div class="doc-item">
            <h4>Mortal Strike</h4>
            <p><span class="stat">Cost: 30 Rage</span> | <span class="stat">Type: Physical</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">mortal_strike</span></span></p>
            <p>Massive blow. Scales with Attack (2.0x) and d6 power.</p>
          </div>

          <div class="doc-item">
            <h4>Execute</h4>
            <p><span class="stat">Cost: 20 Rage</span> | <span class="stat">Type: Physical</span> | <span class="stat">Cooldown: 1</span></p>
            <p><span class="stat">Command: <span class="kbd">execute</span></span></p>
            <p>Finishing strike that can only be used when the enemy is below 20% HP. Scales with Attack (1.5x) and d6 power.</p>
          </div>

          <div class="doc-item">
            <h4>Die by the Sword</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 10</span></p>
            <p><span class="stat">Command: <span class="kbd">die_by_sword</span></span></p>
            <p>Become immune to physical damage and reduce all incoming damage by 30% for 2 turns.</p>
          </div>

          <div class="doc-item">
            <h4>Dragon Roar</h4>
            <p><span class="stat">Cost: 10 Rage</span> | <span class="stat">Type: Physical (AoE)</span> | <span class="stat">Cooldown: 25</span></p>
            <p><span class="stat">Command: <span class="kbd">dragon_roar</span></span></p>
            <p>Roar ferociously to damage all enemies for [Attack (0.8x) + d6] damage. Always critically strikes, ignores Physical Reduction, and applies a 4-turn physical bleed on hit, dealing [Attack (0.4x) + d2] damage each turn. As AoE, it can reveal stealth and destroys Imps when it deals damage.</p>
          </div>

          <div class="doc-item">
            <h4>Ignore Pain</h4>
            <p><span class="stat">Cost: 5 Rage</span> | <span class="stat">Cooldown: 6</span></p>
            <p><span class="stat">Command: <span class="kbd">ignore_pain</span></span></p>
            <p>Gain an absorb shield equal to Attack (0.5x) + d4.</p>
          </div>
        </div>

        <h4 class="doc-subtitle">Mage</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Fireball</h4>
            <p><span class="stat">Cost: 10 Mana</span> | <span class="stat">Type: Magic</span> | <span class="stat">Cooldown: 1</span></p>
            <p><span class="stat">Command: <span class="kbd">fireball</span></span></p>
            <p>Throws a fiery ball to the enemy. Damage scales with Intellect (0.4x) and d6 power. 20% chance to trigger Hot Streak.</p>
          </div>

          <div class="doc-item">
            <h4>Fire Blast</h4>
            <p><span class="stat">Cost: 15 Mana</span> | <span class="stat">Type: Magic</span> | <span class="stat">Cooldown: 8</span></p>
            <p><span class="stat">Command: <span class="kbd">fire_blast</span></span></p>
            <p>Blast the enemy for Intellect (0.4x) + d4 magic damage. Always triggers Hot Streak on hit.</p>
          </div>

          <div class="doc-item">
            <h4>Arcane Barrage</h4>
            <p><span class="stat">Cost: 15 Mana</span> | <span class="stat">Type: Magic</span> | <span class="stat">Cooldown: 2</span></p>
            <p><span class="stat">Command: <span class="kbd">arcane_barrage</span></span></p>
            <p>Launches 3 bolts of arcane energy at the enemy target. Each bolt deals Intellect (0.4x) plus d6 power.</p>
          </div>

          <div class="doc-item">
            <h4>Pyroblast</h4>
            <p><span class="stat">Cost: 20 Mana</span> | <span class="stat">Type: Magic</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">pyroblast</span></span></p>
            <p>Devastating spell that requires Hot Streak. Scales with Intellect (2.0x) and d10 power.</p>
          </div>

          <div class="doc-item">
            <h4>Ring of Ice</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 3</span></p>
            <p><span class="stat">Command: <span class="kbd">ring_of_ice</span></span></p>
            <p>Freezes the enemy in place, stunning them for 1 turn.</p>
          </div>

          <div class="doc-item">
            <h4>Ice Block</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 20</span></p>
            <p><span class="stat">Command: <span class="kbd">iceblock</span></span></p>
            <p>Become immune to all damage for 3 turns. Restores 10 HP and 25 Mana each turn, but you cannot act. Also dispels your magical DoTs (does not remove physical bleeds/poisons).</p>
          </div>

          <div class="doc-item">
            <h4>Blink</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 6</span></p>
            <p><span class="stat">Command: <span class="kbd">blink</span></span></p>
            <p>Blinks away, causing enemy attacks to miss for the current and next turn.</p>
          </div>

          <div class="doc-item">
            <h4>Ice Barrier</h4>
            <p><span class="stat">Cost: 10 Mana</span> | <span class="stat">Cooldown: 15</span></p>
            <p><span class="stat">Command: <span class="kbd">ice_barrier</span></span></p>
            <p>Wrap yourself in a shield that absorbs damage based on Intellect (0.9x) plus a d6 roll.</p>
          </div>
        </div>

        <h4 class="doc-subtitle">Rogue</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Cheap Shot</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 3</span></p>
            <p><span class="stat">Command: <span class="kbd">cheap_shot</span></span></p>
            <p>Stuns the enemy for 1 turn.</p>
          </div>

          <div class="doc-item">
            <h4>Kidney Shot</h4>
            <p><span class="stat">Cost: 5 Energy</span> | <span class="stat">Cooldown: 10</span></p>
            <p><span class="stat">Command: <span class="kbd">kidney_shot</span></span></p>
            <p>Stuns the enemy for 2 turns.</p>
          </div>

          <div class="doc-item">
            <h4>Vanish</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 15</span></p>
            <p><span class="stat">Command: <span class="kbd">vanish</span></span></p>
            <p>Enter Stealth for 3 turns, restoring 15 HP and 5 Energy each turn. Stealth breaks if you take more than 5 damage.</p>
          </div>

          <div class="doc-item">
            <h4>Cloak of Shadows</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 20</span></p>
            <p><span class="stat">Command: <span class="kbd">cloak</span></span></p>
            <p>Become immune to magic damage for 2 turns and dispel all magical DoTs (physical bleeds/poisons remain).</p>
          </div>

          <div class="doc-item">
            <h4>Eviscerate</h4>
            <p><span class="stat">Cost: 30 Energy</span> | <span class="stat">Type: Physical</span> | <span class="stat">Cooldown: 1</span></p>
            <p><span class="stat">Command: <span class="kbd">eviscerate</span></span></p>
            <p>Heavy strike that scales with Attack (1.2x) and d10 power.</p>
          </div>

          <div class="doc-item">
            <h4>Evasion</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 20</span></p>
            <p><span class="stat">Command: <span class="kbd">evasion</span></span></p>
            <p>For 2 turns, incoming single-target physical damage abilities automatically miss (<span class="stat">Evaded!</span>). Does not affect magical attacks, AoE abilities, DoTs, or non-damage effects.</p>
          </div>

          <div class="doc-item">
            <h4>Thistle Tea</h4>
            <p><span class="stat">Cost: 30 Energy</span> | <span class="stat">Cooldown: 15</span></p>
            <p><span class="stat">Command: <span class="kbd">thistle_tea</span></span></p>
            <p>Restore 30 Energy at the end of each turn for 3 turns.</p>
          </div>

          <div class="doc-item">
            <h4>Shadow Blade</h4>
            <p><span class="stat">Cost: 15 Energy</span> | <span class="stat">Type: Physical</span></p>
            <p><span class="stat">Command: <span class="kbd">shadow_blade</span></span></p>
            <p>Quick strike that scales with Attack (0.5x) and d6 power. While stealthed, it scales with Attack (1.3x) and d8 power. 20% chance to proc Ambush when not stealthed, and 100% chance when stealthed.</p>
          </div>

          <div class="doc-item">
            <h4>Ambush</h4>
            <p><span class="stat">Cost: 15 Energy</span> | <span class="stat">Type: Physical</span></p>
            <p><span class="stat">Command: <span class="kbd">ambush</span></span></p>
            <p>Powerful strike only usable after an Ambush proc. Scales with Attack (2.0x) and d6 power.</p>
          </div>

        </div>

        <h4 class="doc-subtitle">Druid</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Bear Form</h4>
            <p><span class="stat">Command: <span class="kbd">bear</span></span></p>
            <p>Shift into Bear Form to access Rage-based abilities.</p>
            <p><span class="stat">Maul:</span> <span class="kbd">maul</span> — Cost: 0 Rage | Cooldown: 0 | Effect: Attack (0.3x) + d4. Generates Rage equal to 3x damage dealt.</p>
            <p><span class="stat">Swipe:</span> <span class="kbd">swipe</span> — Cost: 5 Rage | Cooldown: 10 | Effect: AOE Attack (0.5x) + d8. Can hit stealthed targets.</p>
            <p><span class="stat">Frenzied Regeneration:</span> <span class="kbd">frenzied_regeneration</span> — Cost: all current Rage | Cooldown: 30 | Effect: Heals over 4 turns based on consumed Rage.</p>
            <p><span class="stat">Barkskin:</span> <span class="kbd">barkskin</span> — Cost: 0 Rage | Cooldown: 15 | Effect: Gain 35% damage reduction for 3 turns. Persists through form shifts.</p>
            <p><span class="stat">Passive:</span> The Rage Within — Effect: Gain Rage equal to HP damage taken.</p>
          </div>

          <div class="doc-item">
            <h4>Cat Form</h4>
            <p><span class="stat">Command: <span class="kbd">cat</span></span></p>
            <p>Shift into Cat Form to access Energy-based abilities.</p>
            <p><span class="stat">Claw:</span> <span class="kbd">claw</span> — Cost: 10 Energy | Cooldown: 0 | Effect: Attack (1.0x) + d4. 25% chance to enable Rip.</p>
            <p><span class="stat">Shred:</span> <span class="kbd">shred</span> — Cost: 15 Energy | Cooldown: 2 | Effect: Attack (1.5x) + d4.</p>
            <p><span class="stat">Rip:</span> <span class="kbd">rip</span> — Cost: 0 Energy | Cooldown: 0 | Requirement: Rip proc | Effect: Attack (2.0x) + d8 and restores 5 Energy.</p>
            <p><span class="stat">Maim:</span> <span class="kbd">maim</span> — Cost: 10 Energy | Cooldown: 15 | Effect: Stuns enemy for 3 turns.</p>
            <p><span class="stat">Prowl:</span> <span class="kbd">prowl</span> — Cost: 0 Energy | Cooldown: 15 | Effect: Enter stealth for 3 turns and restore 15 Energy each turn.</p>
          </div>

          <div class="doc-item">
            <h4>Moonkin Form</h4>
            <p><span class="stat">Command: <span class="kbd">moonkin</span></span></p>
            <p>Shift into Moonkin Form to access Mana-based spells.</p>
            <p><span class="stat">Wrath:</span> <span class="kbd">wrath</span> — Cost: 15 Mana | Cooldown: 0 | Effect: Intellect (1.0x) + d6. 25% chance to enable Starfire.</p>
            <p><span class="stat">Starfire:</span> <span class="kbd">starfire</span> — Cost: 20 Mana | Cooldown: 0 | Requirement: Starfire proc | Effect: Intellect (2.0x) + d6.</p>
            <p><span class="stat">Cyclone:</span> <span class="kbd">cyclone</span> — Cost: 0 Mana | Cooldown: 20 | Effect: Traps enemy in a cyclone for 2 turns. Enemy cannot act, and cannot take damage or healing while affected.</p>
            <p><span class="stat">Typhoon:</span> <span class="kbd">typhoon</span> — Cost: 0 Mana | Cooldown: 5 | Effect: Blasts enemy away and causes their attacks to miss this turn and next turn.</p>
          </div>

          <div class="doc-item">
            <h4>Tree Form</h4>
            <p><span class="stat">Command: <span class="kbd">tree</span></span></p>
            <p>Shift into Tree Form to access powerful healing. Grants 2 Magic Resist.</p>
            <p><span class="stat">Wild Growth:</span> <span class="kbd">wild_growth</span> — Cost: 70 Mana | Cooldown: 0 | Effect: Heal for (Intellect + Attack) (1.6x) + d8.</p>
            <p><span class="stat">Regrowth:</span> <span class="kbd">regrowth</span> — Cost: 15 Mana | Cooldown: 15 | Effect: Heal over time for 5 turns using (Intellect + Attack) (1.5x) + d4 total scaling.</p>
            <p><span class="stat">Innervate:</span> <span class="kbd">innervate</span> — Cost: 0 Mana | Cooldown: 50 | Effect: Restore Mana to full.</p>
          </div>

        </div>
      </div>

      <div class="doc-section">
        <h4 class="doc-subtitle">Warlock</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Agony</h4>
            <p><span class="stat">Cost: 20 Mana</span> | <span class="stat">Cooldown: 10</span></p>
            <p><span class="stat">Command: <span class="kbd">agony</span></span></p>
            <p>Inflicts Agony for 10 turns. Deals increasing magical DoT damage from 1 up to 10. Not dispellable and not stackable.</p>
          </div>
          <div class="doc-item">
            <h4>Corruption</h4>
            <p><span class="stat">Cost: 10 Mana</span> | <span class="stat">Cooldown: 8</span></p>
            <p><span class="stat">Command: <span class="kbd">corruption</span></span></p>
            <p>Magical DoT over 8 turns. Damage uses Intellect (3.0x) + d4 and refreshes (no stacking).</p>
          </div>
          <div class="doc-item">
            <h4>Unstable Affliction</h4>
            <p><span class="stat">Cost: 20 Mana</span> | <span class="stat">Cooldown: 10</span></p>
            <p><span class="stat">Command: <span class="kbd">unstable_affliction</span></span></p>
            <p>Magical DoT over 10 turns. Damage uses Intellect (3.5x) + d4 and refreshes (no stacking).</p>
          </div>
          <div class="doc-item">
            <h4>Drain Life</h4>
            <p><span class="stat">Cost: 5 Mana</span> | <span class="stat">Cooldown: 3</span></p>
            <p><span class="stat">Command: <span class="kbd">drain_life</span></span></p>
            <p>Deals magical damage (Intellect 0.8x + d6) and heals for damage dealt.</p>
          </div>
          <div class="doc-item">
            <h4>Healthstone</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 8</span></p>
            <p><span class="stat">Command: <span class="kbd">healthstone</span></span></p>
            <p>Heals the warlock for 25% of max HP.</p>
          </div>
          <div class="doc-item">
            <h4>Fear</h4>
            <p><span class="stat">Cost: 5 Mana</span> | <span class="stat">Cooldown: 6</span></p>
            <p><span class="stat">Command: <span class="kbd">fear</span></span></p>
            <p>Fears the enemy for 1 turn (stun-like action denial).</p>
          </div>
          <div class="doc-item">
            <h4>Summon Imp</h4>
            <p><span class="stat">Cost: 10 Mana</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">summon_imp</span></span></p>
            <p>Summons an Imp (max 3). Each Imp casts Firebolt at the enemy, at the end of your turn.</p>
          </div>
          <div class="doc-item">
            <h4>Demonic Gateway</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 25</span></p>
            <p><span class="stat">Command: <span class="kbd">demonic_gateway</span></span></p>
            <p>The Warlock tears open a passage, steps through the Gateway to emerge from the other side. Causes enemy offensive abilities to miss for 2 turns.</p>
          </div>
          <div class="doc-item">
            <h4>Demonic Circle</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">demonic_circle</span></span></p>
            <p>Summons a persistent Demonic Circle.</p>
          </div>
          <div class="doc-item">
            <h4>Demonic Circle: Teleport</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 30</span></p>
            <p><span class="stat">Command: <span class="kbd">teleport</span></span></p>
            <p>Requires Demonic Circle. The Warlock teleports to their Demonic Circle. Causes enemy offensive abilities to miss for 2 turns.</p>
          </div>
        </div>

        <h4 class="doc-subtitle">Paladin</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Crusader Strike</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">crusader_strike</span></span></p>
            <p>Deals physical damage (Attack 0.4x + d6) and generates 5 Mana. 30% chance to empower Final Verdict.</p>
          </div>
          <div class="doc-item">
            <h4>Judgment</h4>
            <p><span class="stat">Cost: 5 Mana</span> | <span class="stat">Cooldown: 3</span></p>
            <p><span class="stat">Command: <span class="kbd">judgment</span></span></p>
            <p>Deals magic damage (Attack 1.0x + d6).</p>
          </div>
          <div class="doc-item">
            <h4>Final Verdict</h4>
            <p><span class="stat">Cost: 10 Mana</span> | <span class="stat">Cooldown: 6</span></p>
            <p><span class="stat">Command: <span class="kbd">final_verdict</span></span></p>
            <p>Deals physical damage (Attack 1.1x + d8). If empowered, deals (Attack 2.0x + d8) once.</p>
          </div>
          <div class="doc-item">
            <h4>Holy Light</h4>
            <p><span class="stat">Cost: 30 Mana</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">holy_light</span></span></p>
            <p>Heals self for (Intellect 2.0x + d4).</p>
          </div>
          <div class="doc-item">
            <h4>Hammer of Justice</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 15</span></p>
            <p><span class="stat">Command: <span class="kbd">hammer_of_justice</span></span></p>
            <p>Stuns the enemy for 2 turns.</p>
          </div>
          <div class="doc-item">
            <h4>Divine Shield</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 25</span></p>
            <p><span class="stat">Command: <span class="kbd">divine_shield</span></span></p>
            <p>Become immune to incoming damage and debuffs for 2 turns, can still act, and dispels magical DoTs on cast.</p>
          </div>
          <div class="doc-item">
            <h4>Shield of Vengeance</h4>
            <p><span class="stat">Cost: 10 Mana</span> | <span class="stat">Cooldown: 25</span></p>
            <p><span class="stat">Command: <span class="kbd">shield_of_vengeance</span></span></p>
            <p>Gain an absorb shield for 3 turns (Attack 0.8x + d6). On expiry or full consume, explodes for absorbed total as AoE magic damage.</p>
          </div>
          <div class="doc-item">
            <h4>Lay on Hands</h4>
            <p><span class="stat">Cost: 20 Mana</span> | <span class="stat">Cooldown: 50</span></p>
            <p><span class="stat">Command: <span class="kbd">lay_on_hands</span></span></p>
            <p>Restore your HP to full.</p>
          </div>
          <div class="doc-item">
            <h4>Avenging Wrath</h4>
            <p><span class="stat">Cost: 20 Mana</span> | <span class="stat">Cooldown: 20</span></p>
            <p><span class="stat">Command: <span class="kbd">avenging_wrath</span></span></p>
            <p>For 4 turns, increases outgoing damage by 20%. Also empowers Crusader Strike and Judgment multipliers.</p>
          </div>
        </div>

        <h4 class="doc-subtitle">Priest</h4>
        <div class="doc-grid">
          <div class="doc-item">
            <h4>Power Word: Shield</h4>
            <p><span class="stat">Cost: 20 Mana</span> | <span class="stat">Cooldown: 8</span></p>
            <p><span class="stat">Command: <span class="kbd">shield</span></span></p>
            <p>Gain an absorb shield for [Intellect (1.0x) + d6].</p>
          </div>
          <div class="doc-item">
            <h4>Mind Flay</h4>
            <p><span class="stat">Cost: 5 Mana</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">mind_flay</span></span></p>
            <p>Deals [Intellect (0.4x) + d4] magic damage. 40% chance to empower your next Mind Blast.</p>
          </div>
          <div class="doc-item">
            <h4>Mind Blast</h4>
            <p><span class="stat">Cost: 15 Mana</span> | <span class="stat">Cooldown: 3</span></p>
            <p><span class="stat">Command: <span class="kbd">mind_blast</span></span></p>
            <p>Deals [Intellect (0.9x) + d6] magic damage, or [Intellect (1.3x) + d8] while empowered.</p>
          </div>
          <div class="doc-item">
            <h4>Vampiric Touch</h4>
            <p><span class="stat">Cost: 12 Mana</span> | <span class="stat">Cooldown: 8</span></p>
            <p><span class="stat">Command: <span class="kbd">vampiric_touch</span></span></p>
            <p>Applies a 6-turn magical DoT from [Intellect (3.0x) + d6] total damage. Priest heals for 40% of tick damage dealt.</p>
          </div>
          <div class="doc-item">
            <h4>Devouring Plague</h4>
            <p><span class="stat">Cost: 25 Mana</span> | <span class="stat">Cooldown: 0</span></p>
            <p><span class="stat">Command: <span class="kbd">devouring_plague</span></span></p>
            <p>Requires Shadowy Insight. Applies a 4-turn magical DoT from [Intellect (2.0x) + d4] total damage and heals for 30% of tick damage dealt.</p>
          </div>
          <div class="doc-item">
            <h4>Penance</h4>
            <p><span class="stat">Cost: 12 Mana</span> | <span class="stat">Cooldown: 8 (shared)</span></p>
            <p><span class="stat">Commands: <span class="kbd">penance</span>, <span class="kbd">penance_self</span></span></p>
            <p>3 hits per cast. Penance deals [Intellect (0.4x) + d4] magic damage per hit; Penance (Self) heals [Intellect (0.4x) + d4] per hit.</p>
          </div>
          <div class="doc-item">
            <h4>Flash Heal</h4>
            <p><span class="stat">Cost: 25 Mana</span> | <span class="stat">Cooldown: 3</span></p>
            <p><span class="stat">Command: <span class="kbd">flash_heal</span></span></p>
            <p>Heals self for [Intellect (0.9x) + d8].</p>
          </div>
          <div class="doc-item">
            <h4>Pain Suppression</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 20</span></p>
            <p><span class="stat">Command: <span class="kbd">pain_supp</span></span></p>
            <p>Reduces all incoming damage by 40% for 3 turns.</p>
          </div>
          <div class="doc-item">
            <h4>Mindgames</h4>
            <p><span class="stat">Cost: 15 Mana</span> | <span class="stat">Cooldown: 20</span></p>
            <p><span class="stat">Command: <span class="kbd">mindgames</span></span></p>
            <p>Applies a 1-turn debuff that flips target damage into healing and target healing into self-damage.</p>
          </div>
          <div class="doc-item">
            <h4>Mass Dispel</h4>
            <p><span class="stat">Cost: 12 Mana</span> | <span class="stat">Cooldown: 20</span></p>
            <p><span class="stat">Command: <span class="kbd">mass_dispel</span></span></p>
            <p>Dispels all magical DoTs on self, dispels enemy HoTs (Regrowth), and removes enemy Stealth, Ice Block, and Divine Shield.</p>
          </div>
          <div class="doc-item">
            <h4>Shadow Word: Death</h4>
            <p><span class="stat">Cost: Free</span> | <span class="stat">Cooldown: 5</span></p>
            <p><span class="stat">Command: <span class="kbd">death</span></span></p>
            <p>Deals [Intellect (1.0x) + d6] magic damage. If target HP is below 20%, damage is doubled.</p>
          </div>
          <div class="doc-item">
            <h4>Shadowfiend</h4>
            <p><span class="stat">Cost: 20 Mana</span> | <span class="stat">Cooldown: 50</span></p>
            <p><span class="stat">Command: <span class="kbd">shadowfiend</span></span></p>
            <p>Summons a Shadowfiend for 5 turns. It attacks each turn for [Intellect (0.6x) + d4] physical damage and restores 13 mana on successful hits. If enemies kill it, Priest gains 40 mana and heals 15% max HP.</p>
          </div>
        </div>

        <h3>Combat Mechanics</h3>
        <div class="doc-content">
          <p><strong>Damage Types:</strong> Physical damage is reduced by Physical Reduction. Magic damage is reduced by Magic Resist.</p>
          
          <p><strong>Critical Hits:</strong> Each class has a crit chance. Critical hits deal 150% damage.</p>
          
          <p><strong>Accuracy & Evasion:</strong> Attacks can miss based on attacker's Accuracy vs defender's Evasion. The <span class="stat">Evasion</span> cooldown specifically forces misses only against single-target physical damage abilities.</p>
          
          <p><strong>Damage over Time (DoT):</strong> DoTs are typed by school. Burn is a magical, dispellable DoT that deals damage at the end of each turn and refreshes instead of stacking. Physical bleeds/poisons are not removed by magical dispels.</p>
          
          <p><strong>Passive Healing:</strong> Spirit Light Sword and Staff of Immortality heal automatically at turn end.</p>
          
          <p><strong>Resource Regeneration:</strong> Mana regenerates 2 per turn. Energy regenerates 5 per turn.</p>

          <p><strong>Stealth:</strong> Stealthed targets cannot be hit until they attack or take more than 5 damage.</p>
        </div>
      </div>

      <div class="doc-section">
        <h3>How to Play</h3>
        <div class="doc-content">
          <p><strong>1. Join Queue:</strong> Click "Enter the Arena" to find an opponent.</p>
          
          <p><strong>2. Prep Phase:</strong> Choose your class with <span class="kbd">/class warrior</span>, <span class="kbd">/class mage</span>, <span class="kbd">/class rogue</span>, <span class="kbd">/class druid</span>, <span class="kbd">/class warlock</span>, or <span class="kbd">/class paladin</span>, or <span class="kbd">/class priest</span></p>
          
          <p><strong>3. Equip Items:</strong> Use <span class="kbd">/item weapon steel_long_sword</span> and <span class="kbd">/item armor plate_armor</span></p>
          
          <p><strong>4. Combat:</strong> Type ability names like <span class="kbd">basic_attack</span> or <span class="kbd">fireball</span> to attack each turn.</p>
          
          <p><strong>5. Victory:</strong> Reduce enemy HP to 0 to win. Last champion standing wins!</p>
        </div>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script>
      const logDiv = document.getElementById("log");
      const cmdInput = document.getElementById("commandInput");
      const sendBtn = document.getElementById("sendBtn");
      const queueBtn = document.getElementById("queueBtn");
      const chatBox = document.getElementById("chatBox");
      const chatInput = document.getElementById("chatInput");
      const chatSendBtn = document.getElementById("chatSendBtn");
      const cooldownTracker = document.getElementById("cooldownTracker");

      const connDot = document.getElementById("connDot");
      const connText = document.getElementById("connText");
      const roleText = document.getElementById("roleText");
      const friendlyLabel = document.getElementById("friendlyLabel");
      const enemyLabel = document.getElementById("enemyLabel");
      
      const friendlyHpText = document.getElementById("friendlyHpText");
      const friendlyHpBar = document.getElementById("friendlyHpBar");
      const friendlyAbsorbBar = document.getElementById("friendlyAbsorbBar");
      const friendlyPrimaryLabel = document.getElementById("friendlyPrimaryLabel");
      const friendlyPrimaryText = document.getElementById("friendlyPrimaryText");
      const friendlyPrimaryBar = document.getElementById("friendlyPrimaryBar");
      const friendlyWeapon = document.getElementById("friendlyWeapon");
      const friendlyArmor = document.getElementById("friendlyArmor");
      const friendlyTrinket = document.getElementById("friendlyTrinket");
      const friendlyStatus = document.getElementById("friendlyStatus");
      
      const enemyHpText = document.getElementById("enemyHpText");
      const enemyHpBar = document.getElementById("enemyHpBar");
      const enemyAbsorbBar = document.getElementById("enemyAbsorbBar");
      const enemyPrimaryLabel = document.getElementById("enemyPrimaryLabel");
      const enemyPrimaryText = document.getElementById("enemyPrimaryText");
      const enemyPrimaryBar = document.getElementById("enemyPrimaryBar");
      const enemyWeapon = document.getElementById("enemyWeapon");
      const enemyArmor = document.getElementById("enemyArmor");
      const enemyTrinket = document.getElementById("enemyTrinket");
      const enemyStatus = document.getElementById("enemyStatus");
      const lockBtn = document.getElementById("lockBtn");
      const passBtn = document.getElementById("passBtn");

      const socket = io();
      let myRole = null;

      function escapeHtml(text) {
        return text
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function escapeRegExp(text) {
        return text.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      }

      const warriorAbilities = [
        "Overpower",
        "Victory Rush",
        "Rampage",
        "Mortal Strike",
        "Execute",
        "Die by the Sword",
        "Dragon Roar",
        "Ignore Pain",
      ];
      const mageAbilities = [
        "Fireball",
        "Fire Blast",
        "Arcane Barrage",
        "Pyroblast",
        "Ice Block",
        "Ring of Ice",
        "Blink",
        "Ice Barrier",
      ];
      const rogueAbilities = [
        "Cheap Shot",
        "Kidney Shot",
        "Vanish",
        "Cloak of Shadows",
        "Eviscerate",
        "Evasion",
        "Shadow Blade",
        "Ambush",
        "Thistle Tea",
        "Fury of Azzinoth",
      ];
      const warlockAbilities = [
        "Agony",
        "Corruption",
        "Unstable Affliction",
        "Drain Life",
        "Healthstone",
        "Fear",
        "Summon Imp",
        "Demonic Gateway",
        "Demonic Circle: Teleport",
        "Demonic Circle",
      ];
      const paladinAbilities = [
        "Crusader Strike",
        "Judgment",
        "Final Verdict",
        "Holy Light",
        "Hammer of Justice",
        "Divine Shield",
        "Shield of Vengeance",
        "Lay on Hands",
        "Avenging Wrath",
      ];
      const priestAbilities = [
        "Power Word: Shield",
        "Mind Flay",
        "Mind Blast",
        "Vampiric Touch",
        "Devouring Plague",
        "Penance",
        "Penance (Self)",
        "Pain Suppression",
        "Mindgames",
        "Flash Heal",
        "Mass Dispel",
        "Shadow Word: Death",
        "Shadowfiend",
      ];
      const druidAbilities = [
        "Bear Form",
        "Cat Form",
        "Moonkin Form",
        "Tree Form",
        "Maul",
        "Swipe",
        "Frenzied Regeneration",
        "Barkskin",
        "Claw",
        "Shred",
        "Maim",
        "Rip",
        "Prowl",
        "Wrath",
        "Starfire",
        "Cyclone",
        "Typhoon",
        "Wild Growth",
        "Regrowth",
        "Innervate",
        "The Rage Within",
      ];
      const greenItems = [
        "Steel Long Sword",
        "Wand of Fire",
        "Plate Armor",
        "Steel Daggers",
        "Cloth Armor",
      ];
      const blueItems = [
        "Spirit Light Sword",
        "Staff of Immortality",
        "Leather Armor",
        "Focus Charm",
        "Rage Crystal",
        "Spear of Light",
      ];
      const purpleItems = [
        "Glock 19",
        "Void Blades",
        "Crusader's Greatsword",
      ];
      const orangeItems = [
        "Thunderfury, Blessed Blade of the Windseeker",
        "Dragonwrath, Tarecgosa's Rest",
        "Twin Blades of Azzinoth",
      ];

      function itemClassForName(name) {
        if (!name) {
          return "";
        }
        if (greenItems.includes(name)) {
          return "log-item-green";
        }
        if (blueItems.includes(name)) {
          return "log-item-blue";
        }
        if (purpleItems.includes(name)) {
          return "log-item-purple";
        }
        if (orangeItems.includes(name)) {
          return "log-item-orange";
        }
        return "";
      }

      const fxTagPattern = /\[\[fx:(fx_thunderfury|fx_dragonwrath|fx_twin_blades_azzinoth)\]\]([\s\S]*?)\[\[\/fx\]\]/g;
      let thunderfuryFxCounter = 0;
      let dragonwrathFxCounter = 0;
      let twinBladesFxCounter = 0;

      function stripFxTags(text) {
        if (!text) {
          return text;
        }
        return text.replace(fxTagPattern, "$2");
      }

      function renderTextWithFxTags(text) {
        const source = String(text || "");
        let html = "";
        let lastIndex = 0;
        fxTagPattern.lastIndex = 0;
        let match;
        while ((match = fxTagPattern.exec(source)) !== null) {
          html += escapeHtml(source.slice(lastIndex, match.index));
          const fxId = match[1];
          const value = match[2];
          if (fxId === "fx_thunderfury") {
            html += `<span class="fx fx_thunderfury"><span class="log-item-orange fx-thunderfury-text">${escapeHtml(value)}</span><span class="fx-thunderfury-overlay" aria-hidden="true"></span></span>`;
          } else if (fxId === "fx_dragonwrath") {
            html += `<span class="fx fx_dragonwrath"><span class="log-item-orange">${escapeHtml(value)}</span></span>`;
          } else if (fxId === "fx_twin_blades_azzinoth") {
            html += `<span class="fx fx_twin_blades_azzinoth"><span class="log-item-orange">${escapeHtml(value)}</span></span>`;
          } else {
            html += escapeHtml(value);
          }
          lastIndex = match.index + match[0].length;
        }
        html += escapeHtml(source.slice(lastIndex));
        return html;
      }

      function setItemLabel(element, name) {
        const plainName = stripFxTags(name || "");
        element.classList.remove("log-item-green", "log-item-blue", "log-item-purple", "log-item-orange");
        if (!name) {
          element.textContent = "--";
          return;
        }
        const itemClass = itemClassForName(plainName);
        if (itemClass) {
          element.classList.add(itemClass);
        }
        element.innerHTML = renderTextWithFxTags(name);
        initThunderfuryFx(element);
        initDragonwrathFx(element);
        initTwinBladesFx(element);
      }


      function randomInRange(min, max) {
        return min + Math.random() * (max - min);
      }

      function setDash(pathEl) {
        const len = pathEl.getTotalLength();
        pathEl.style.strokeDasharray = `${len}`;
        pathEl.style.strokeDashoffset = `${len}`;
        pathEl.style.setProperty("--dash", len);
      }

      function buildMainStrike(W, H) {
        // Spread origins across almost the full label so left-side words (e.g. "Thunderfury") can be hit.
        const startX = W * randomInRange(0.05, 0.95);
        const startY = H * randomInRange(0.2, 0.8);

        // Use 360° direction + diagonal-based travel so paths can sweep both left and right words.
        const angle = randomInRange(-Math.PI, Math.PI);
        const length = Math.hypot(W, H) * randomInRange(1.1, 1.6);
        
        const segments = Math.floor(randomInRange(6, 10));
        const stepLen = length / segments;
        
        let x = startX;
        let y = startY;
        let currentAngle = angle;
        let d = `M ${x.toFixed(1)} ${y.toFixed(1)}`;
        
        for (let i = 1; i <= segments; i++) {
          // Add jagged variation to angle
          currentAngle += randomInRange(-0.5, 0.5);
          
          // Move in the angled direction with some randomness
          x += Math.cos(currentAngle) * stepLen + randomInRange(-stepLen * 0.3, stepLen * 0.3);
          y += Math.sin(currentAngle) * stepLen + randomInRange(-stepLen * 0.2, stepLen * 0.2);
          
          d += ` L ${x.toFixed(1)} ${y.toFixed(1)}`;
        }
        
        return d;
      }

      function pathToPoints(d) {
        const parts = d.replace(/[ML]/g, "").trim().split(/\s+/).map(Number);
        const pts = [];
        for (let i = 0; i < parts.length; i += 2) {
          pts.push([parts[i], parts[i + 1]]);
        }
        return pts;
      }

      function buildBranchStrike(W, H, mainPoints) {
        if (mainPoints.length < 2) return "";
        
        // Pick a point along the main strike (not too early, not too late)
        const idx = Math.floor(mainPoints.length * randomInRange(0.25, 0.65));
        const p0 = mainPoints[idx];
        
        // Create a short branch off the main bolt
        const segments = Math.floor(randomInRange(2, 4));
        const branchAngle = randomInRange(-Math.PI * 0.8, Math.PI * 0.8);
        const branchLen = Math.max(W, H) * randomInRange(0.2, 0.4);
        const stepLen = branchLen / segments;
        
        let x = p0[0];
        let y = p0[1];
        let currentAngle = branchAngle;
        let d = `M ${x.toFixed(1)} ${y.toFixed(1)}`;
        
        for (let i = 1; i <= segments; i++) {
          currentAngle += randomInRange(-0.6, 0.6);
          x += Math.cos(currentAngle) * stepLen + randomInRange(-stepLen * 0.4, stepLen * 0.4);
          y += Math.sin(currentAngle) * stepLen + randomInRange(-stepLen * 0.3, stepLen * 0.3);
          d += ` L ${x.toFixed(1)} ${y.toFixed(1)}`;
        }
        
        return d;
      }

      function triggerThunderfuryFlash(span) {
        const fx = span._thunderfuryFx;
        if (!fx) {
          return;
        }
        const anchorEl = fx.textNode || span;
        const rect = anchorEl.getBoundingClientRect();
        const W = rect.width;
        const H = rect.height;
        if (!W || !H) {
          return;
        }
        fx.innerSvg.setAttribute("viewBox", `0 0 ${W} ${H}`);
        fx.maskText.setAttribute("x", W / 2);
        fx.maskText.setAttribute("y", H / 2);
        const computed = window.getComputedStyle(anchorEl);
        fx.maskText.setAttribute("font-size", computed.fontSize);
        fx.maskText.setAttribute("font-family", computed.fontFamily);
        fx.maskText.setAttribute("font-weight", computed.fontWeight || "700");
        fx.maskText.setAttribute("letter-spacing", computed.letterSpacing || "normal");

        // Create 3 lightning strikes
        fx.strikes.forEach((strike) => {
          const mainD = buildMainStrike(W, H);
          const points = pathToPoints(mainD);
          const branchD = buildBranchStrike(W, H, points);

          // Combine main and branch into one path
          const combinedD = mainD + " " + branchD;

          strike.glow.setAttribute("d", combinedD);
          strike.path.setAttribute("d", combinedD);
          setDash(strike.glow);
          setDash(strike.path);
        });

        span.classList.remove("is-zapped");
        void span.offsetWidth;
        span.classList.add("is-zapped");
        setTimeout(() => span.classList.remove("is-zapped"), 650);
      }

      function zapThunderfury(span) {
        const fx = span._thunderfuryFx;
        if (!fx) {
          return;
        }

        if (fx.secondFlashTimer) {
          clearTimeout(fx.secondFlashTimer);
        }

        triggerThunderfuryFlash(span);
        fx.secondFlashTimer = setTimeout(() => {
          if (!span.isConnected) {
            return;
          }
          // Re-roll the paths so the second burst is distinct from the first.
          triggerThunderfuryFlash(span);
        }, 140);
      }

      function mountThunderfuryFx(span) {
        const maskId = `thunderfuryMask_${thunderfuryFxCounter}`;
        thunderfuryFxCounter += 1;
        const textNode = span.querySelector(".fx-thunderfury-text");
        const overlayHost = span.querySelector(".fx-thunderfury-overlay") || span;
        const text = textNode ? textNode.textContent : span.textContent;
        const innerSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        innerSvg.setAttribute("class", "bolt-inner");
        innerSvg.setAttribute("preserveAspectRatio", "none");
        innerSvg.innerHTML = `
          <defs>
            <mask id="${maskId}">
              <rect width="100%" height="100%" fill="black"></rect>
              <text text-anchor="middle" dominant-baseline="middle" fill="white">${escapeHtml(text)}</text>
            </mask>
          </defs>
          <g mask="url(#${maskId})">
            <path class="inner-glow"></path>
            <path class="inner-glow"></path>
            <path class="inner-glow"></path>
            <path class="inner-path"></path>
            <path class="inner-path"></path>
            <path class="inner-path"></path>
          </g>
        `;
        overlayHost.appendChild(innerSvg);
        const maskText = innerSvg.querySelector("text");
        const paths = innerSvg.querySelectorAll("path");
        const mainGlow1 = paths[0];
        const mainGlow2 = paths[1];
        const mainGlow3 = paths[2];
        const mainStrike1 = paths[3];
        const mainStrike2 = paths[4];
        const mainStrike3 = paths[5];
        span._thunderfuryFx = {
          // Track the visible text span so mask sizing/color follows normal legendary text.
          textNode,
          innerSvg,
          maskText,
          strikes: [
            { glow: mainGlow1, path: mainStrike1 },
            { glow: mainGlow2, path: mainStrike2 },
            { glow: mainGlow3, path: mainStrike3 }
          ],
          secondFlashTimer: null,
        };
        span.dataset.fxInit = "1";
        span.addEventListener("click", () => zapThunderfury(span));
        span._thunderfuryTimer = setInterval(() => {
          if (Math.random() < 0.45) {  // Less frequent but more noticeable
            zapThunderfury(span);
          }
        }, 1200);  // Longer intervals between strikes
        zapThunderfury(span);
      }

      function initThunderfuryFx(root = document) {
        const spans = root.querySelectorAll(".fx_thunderfury");
        spans.forEach((span) => {
          if (span.dataset.fxInit === "1") {
            return;
          }
          mountThunderfuryFx(span);
        });
      }



      function createDragonwrathArcaneOrb(container, index) {
        const orb = document.createElement("div");
        orb.className = "arcane-orb";
        container.appendChild(orb);

        const trailSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        trailSvg.setAttribute("class", "arcane-trail");
        trailSvg.style.position = "absolute";
        trailSvg.style.left = "0";
        trailSvg.style.top = "0";
        trailSvg.style.width = "100%";
        trailSvg.style.height = "100%";
        trailSvg.style.pointerEvents = "none";
        trailSvg.style.overflow = "visible";

        const trailPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        trailPath.setAttribute("class", "trail-segment");
        trailSvg.appendChild(trailPath);
        container.appendChild(trailSvg);

        return {
          orb,
          trailSvg,
          trailPath,
          offset: index * 1.57,
          trailPoints: [],
          lastPos: null,
          direction: { x: 1, y: 0 },
        };
      }

      function updateDragonwrathOrbPosition(orbit, bounds, time, profile) {
        const rangeX = bounds.width * profile.rangeXFactor;
        const rangeY = bounds.height * profile.rangeYFactor;
        const centerX = bounds.centerX;
        const centerY = bounds.centerY;

        const x1 = Math.sin(time * 1.2 + orbit.offset) * rangeX;
        const y1 = Math.cos(time * 0.9 + orbit.offset) * rangeY;

        const x2 = Math.sin(time * 2.3 - orbit.offset * 0.5) * (rangeX * 0.6);
        const y2 = Math.cos(time * 1.8 + orbit.offset * 0.7) * (rangeY * 0.6);

        const x3 = Math.cos(time * 3.1 + orbit.offset * 1.3) * (rangeX * 0.3);
        const y3 = Math.sin(time * 2.5 - orbit.offset * 0.9) * (rangeY * 0.3);

        const driftX = Math.sin(time * 0.3 + orbit.offset) * (rangeX * 0.4);
        const driftY = Math.cos(time * 0.4 - orbit.offset) * (rangeY * profile.driftYFactor);

        const x = centerX + x1 + x2 + x3 + driftX;
        const y = centerY + y1 + y2 + y3 + driftY;

        orbit.orb.style.left = `${x}px`;
        orbit.orb.style.top = `${y}px`;

        orbit.trailPoints.push({ x, y, opacity: 1, time });
        orbit.trailPoints = orbit.trailPoints.filter((point) => {
          point.opacity = Math.max(0, 1 - (time - point.time) * 3.5);
          return point.opacity > 0.05;
        });

        if (orbit.trailPoints.length > 30) {
          orbit.trailPoints.shift();
        }

        if (orbit.trailPoints.length > 1) {
          let pathD = `M ${orbit.trailPoints[0].x} ${orbit.trailPoints[0].y}`;
          for (let i = 1; i < orbit.trailPoints.length; i += 1) {
            pathD += ` L ${orbit.trailPoints[i].x} ${orbit.trailPoints[i].y}`;
          }
          orbit.trailPath.setAttribute("d", pathD);

          const avgOpacity = orbit.trailPoints.reduce((sum, point) => sum + point.opacity, 0) / orbit.trailPoints.length;
          orbit.trailPath.style.opacity = avgOpacity * 0.8;
        }

        orbit.lastPos = { x, y };
      }

      function animateDragonwrath(span) {
        const fx = span._dragonwrathFx;
        if (!fx || !fx.container) {
          return;
        }

        const rect = span.getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        const pad = fx.profile.pad;
        const boundsW = width + pad * 2;
        const boundsH = height + pad * 2;

        fx.orbits.forEach((orbit) => {
          orbit.trailSvg.setAttribute("viewBox", `0 0 ${boundsW} ${boundsH}`);
          orbit.trailSvg.setAttribute("width", boundsW);
          orbit.trailSvg.setAttribute("height", boundsH);
          orbit.trailSvg.style.width = `${boundsW}px`;
          orbit.trailSvg.style.height = `${boundsH}px`;
        });

        const bounds = {
          width: boundsW,
          height: boundsH,
          centerX: boundsW / 2,
          centerY: boundsH / 2,
        };

        const startTime = performance.now();
        function frame() {
          const currentTime = performance.now();
          const time = (currentTime - startTime) / 1000;
          fx.orbits.forEach((orbit) => updateDragonwrathOrbPosition(orbit, bounds, time, fx.profile));
          fx.animationId = requestAnimationFrame(frame);
        }

        frame();
      }

      function mountDragonwrathFx(span) {
        const inCombatLog = Boolean(span.closest(".log-line"));
        if (inCombatLog) {
          span.classList.add("fx_dragonwrath-log");
        }
        const container = document.createElement("div");
        container.className = "arcane-container";
        container.id = `dragonwrathMask_${dragonwrathFxCounter}`;
        dragonwrathFxCounter += 1;
        span.appendChild(container);

        const orbits = [
          createDragonwrathArcaneOrb(container, 0),
          createDragonwrathArcaneOrb(container, 1),
          createDragonwrathArcaneOrb(container, 2),
          createDragonwrathArcaneOrb(container, 3),
          createDragonwrathArcaneOrb(container, 4),
        ];

        const profile = inCombatLog
          ? {
              pad: 12,
              rangeXFactor: 0.34,
              rangeYFactor: 0.22,
              driftYFactor: 0.2,
            }
          : {
              pad: 20,
              rangeXFactor: 0.45,
              rangeYFactor: 0.45,
              driftYFactor: 0.4,
            };

        span._dragonwrathFx = {
          container,
          orbits,
          animationId: null,
          profile,
        };

        span.dataset.dragonwrathFxInit = "1";
        animateDragonwrath(span);
      }

      function initDragonwrathFx(root = document) {
        const spans = root.querySelectorAll(".fx_dragonwrath");
        spans.forEach((span) => {
          if (span.dataset.dragonwrathFxInit === "1") {
            return;
          }
          mountDragonwrathFx(span);
        });
      }

      // --- Twin Blades of Azzinoth (click-positioned X slashes with tapered tips) ---
      function clamp(v, min, max) {
        return Math.max(min, Math.min(max, v));
      }

      function setTwinSlashPathData(path, d, width, height) {
        path.setAttribute("d", d);
        // Approximate path length for dash animation
        const approxLength = Math.hypot(width, height) * 1.15;
        path.style.strokeDasharray = `${approxLength}`;
        path.style.strokeDashoffset = `${approxLength}`;
        path.style.setProperty("--length", `${approxLength}`);
      }

      function generateTwinBladesXPaths(width, height, cx, cy) {
        const w = width;
        const h = height;
        const diagHalf = Math.hypot(w, h) / 2;

        // Slash reach: near corner-to-corner (fixes short slashes on wide text)
        const halfLen1 = diagHalf * randomInRange(0.78, 0.95);
        const halfLen2 = diagHalf * randomInRange(0.78, 0.95);

        // Slight angle/curve variation to feel like real swings, but consistent
        const angJitter = randomInRange(-0.14, 0.14);
        const a1 = Math.PI / 4 + angJitter;
        const a2 = -Math.PI / 4 + angJitter;

        const pad = 2;

        function makeSlash(angle, halfLen) {
          const dx = Math.cos(angle);
          const dy = Math.sin(angle);

          const x1 = clamp(cx - dx * halfLen, pad, w - pad);
          const y1 = clamp(cy - dy * halfLen, pad, h - pad);
          const x2 = clamp(cx + dx * halfLen, pad, w - pad);
          const y2 = clamp(cy + dy * halfLen, pad, h - pad);

          // Perpendicular arch for a blade swing arc
          const mx = (x1 + x2) / 2;
          const my = (y1 + y2) / 2;
          const px = -dy;
          const py = dx;
          const arch = randomInRange(-0.22, 0.22) * halfLen;

          const cx1 = clamp(mx + px * arch, pad, w - pad);
          const cy1 = clamp(my + py * arch, pad, h - pad);

          return `M ${x1} ${y1} Q ${cx1} ${cy1} ${x2} ${y2}`;
        }

        return [makeSlash(a1, halfLen1), makeSlash(a2, halfLen2)];
      }

      function executeTwinBladesSlash(fx, width, height, cx, cy) {
        if (fx.secondSlashTimeout) {
          clearTimeout(fx.secondSlashTimeout);
          fx.secondSlashTimeout = null;
        }

        const pathsD = generateTwinBladesXPaths(width, height, cx, cy);

        // Reset animations
        fx.paths.forEach((p) => {
          p.classList.remove("slashing");
          p.style.animation = "none";
        });

        // Force reflow so re-adding the class restarts animation
        void fx.paths[0].getBoundingClientRect();

        // Apply new geometry + dash settings
        setTwinSlashPathData(fx.paths[0], pathsD[0], width, height);
        setTwinSlashPathData(fx.paths[1], pathsD[1], width, height);

        // Trigger first slash
        fx.paths[0].style.animation = "";
        fx.paths[0].classList.add("slashing");

        // Trigger second slash after a short delay for the "X"
        fx.secondSlashTimeout = setTimeout(() => {
          fx.paths[1].style.animation = "";
          fx.paths[1].classList.add("slashing");
          fx.secondSlashTimeout = null;
        }, 300);
      }

      function animateTwinBladesSlash(span, evt = null) {
        const fx = span._twinBladesFx;
        if (!fx) return;

        const rect = span.getBoundingClientRect();
        const width = Math.max(1, rect.width + 48);
        const height = Math.max(1, rect.height + 48);

        fx.svg.setAttribute("viewBox", `0 0 ${width} ${height}`);
        fx.svg.setAttribute("width", width);
        fx.svg.setAttribute("height", height);

        // Default: center of text overlay
        let cx = width / 2;
        let cy = height / 2;

        // If user clicked, place the X center at the cursor position within the text box
        if (evt && typeof evt.clientX === "number") {
          const inset = 24; // matches .slash-container inset:-24px
          cx = clamp(evt.clientX - rect.left + inset, 2, width - 2);
          cy = clamp(evt.clientY - rect.top + inset, 2, height - 2);
        }

        executeTwinBladesSlash(fx, width, height, cx, cy);
      }

      function mountTwinBladesFx(span) {
        const container = document.createElement("div");
        container.className = "slash-container";
        container.id = `twinBladesSlash_${twinBladesFxCounter}`;
        twinBladesFxCounter += 1;
        span.appendChild(container);

        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("class", "slash-svg");
        container.appendChild(svg);

        const path1 = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path1.setAttribute("class", "slash-path");
        svg.appendChild(path1);

        const path2 = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path2.setAttribute("class", "slash-path");
        svg.appendChild(path2);

        span._twinBladesFx = { container, svg, paths: [path1, path2], secondSlashTimeout: null };
        span.dataset.twinBladesFxInit = "1";

        // Auto-play once on mount
        animateTwinBladesSlash(span);

        // Click to play again, centered on cursor
        span.addEventListener("click", (e) => {
          animateTwinBladesSlash(span, e);
        });
      }


      function initTwinBladesFx(root = document) {
        const spans = root.querySelectorAll(".fx_twin_blades_azzinoth");
        spans.forEach((span) => {
          if (span.dataset.twinBladesFxInit === "1") {
            return;
          }
          mountTwinBladesFx(span);
        });
      }

      function applyFxTokensToHtml(output, fxTokens) {
        let html = output;
        fxTokens.forEach(({ token, fxId, value }) => {
          const replacement = fxId === "fx_thunderfury"
            ? `<span class="fx fx_thunderfury"><span class="log-item-orange fx-thunderfury-text">${escapeHtml(value)}</span><span class="fx-thunderfury-overlay" aria-hidden="true"></span></span>`
            : fxId === "fx_dragonwrath"
              ? `<span class="fx fx_dragonwrath"><span class="log-item-orange">${escapeHtml(value)}</span></span>`
              : fxId === "fx_twin_blades_azzinoth"
                ? `<span class="fx fx_twin_blades_azzinoth"><span class="log-item-orange">${escapeHtml(value)}</span></span>`
                : escapeHtml(value);
          html = html.replace(token, replacement);
        });
        return html;
      }

      function highlightLogLine(text) {
        const fxTokens = [];
        const textWithoutFx = String(text).replace(fxTagPattern, (_, fxId, value) => {
          const token = `__FX_TOKEN_${fxTokens.length}__`;
          fxTokens.push({ token, fxId, value });
          return token;
        });
        if (textWithoutFx.startsWith("Post-Combat Summary|")) {
          const parts = textWithoutFx.split("|");
          const values = {};
          parts.slice(1).forEach((entry) => {
            const [key, value] = entry.split(":");
            values[key] = value;
          });
          const friendlyDamage = values.FD ?? "0";
          const friendlyHealing = values.FH ?? "0";
          const enemyDamage = values.ED ?? "0";
          const enemyHealing = values.EH ?? "0";
          return `
            <div class="log-summary">
              <div class="log-summary-title">Post-Combat Summary:</div>
              <div class="log-summary-row">
                <span>Friendly Damage Done: <span class="log-summary-damage">${friendlyDamage}</span></span>
                <span>Friendly Healing Done: <span class="log-summary-heal">${friendlyHealing}</span></span>
              </div>
              <div class="log-summary-row">
                <span>Enemy Damage Done: <span class="log-summary-damage">${enemyDamage}</span></span>
                <span>Enemy Healing Done: <span class="log-summary-heal">${enemyHealing}</span></span>
              </div>
            </div>
          `;
        }
        if (textWithoutFx.includes("HOT STREAK") || textWithoutFx.includes("Can Use Execute")) {
          return applyFxTokensToHtml(renderTextWithFxTags(textWithoutFx), fxTokens);
        }
        if (textWithoutFx.includes("Has Rip!") || textWithoutFx.includes("Has Starfire!")) {
          return applyFxTokensToHtml(`<span class="log-class-druid">${renderTextWithFxTags(textWithoutFx)}</span>`, fxTokens);
        }
        if (textWithoutFx.includes("Has Ambush!")) {
          return applyFxTokensToHtml(`<span class="log-class-rogue">${renderTextWithFxTags(textWithoutFx)}</span>`, fxTokens);
        }
        if (textWithoutFx.includes("Has Final Verdict Empowered!")) {
          return applyFxTokensToHtml(`<span class="log-class-paladin logLinePaladinProc">${renderTextWithFxTags(textWithoutFx)}</span>`, fxTokens);
        }
        if (
          textWithoutFx.includes("Has Shadowy Insight!")
          || textWithoutFx.includes("Mind Blast is empowered!")
          || textWithoutFx.includes("Shadow Word: Death Damage Doubled!")
        ) {
          return applyFxTokensToHtml(`<span class="logLinePriestGlow">${renderTextWithFxTags(textWithoutFx)}</span>`, fxTokens);
        }

        let output = escapeHtml(textWithoutFx);
        const classPatterns = [
          { pattern: /\bWarrior(\(you\))?\b/g, className: "log-class-warrior" },
          { pattern: /\bMage(\(you\))?\b/g, className: "log-class-mage" },
          { pattern: /\bRogue(\(you\))?\b/g, className: "log-class-rogue" },
          { pattern: /\bDruid(\(you\))?\b/g, className: "log-class-druid" },
          { pattern: /\bWarlock(\(you\))?\b/g, className: "log-class-warlock" },
          { pattern: /\bPaladin(\(you\))?\b/g, className: "log-class-paladin" },
          { pattern: /\bPriest(\(you\))?\b/g, className: "log-class-priest" },
        ];
        classPatterns.forEach(({ pattern, className }) => {
          output = output.replace(pattern, `<span class="${className}">$&</span>`);
        });

        warriorAbilities.forEach((ability) => {
          const pattern = new RegExp(`\\b${escapeRegExp(ability)}\\b`, "g");
          output = output.replace(pattern, `<span class="log-ability-warrior">$&</span>`);
        });
        mageAbilities.forEach((ability) => {
          const pattern = new RegExp(`\\b${escapeRegExp(ability)}\\b`, "g");
          output = output.replace(pattern, `<span class="log-ability-mage">$&</span>`);
        });
        rogueAbilities.forEach((ability) => {
          const pattern = new RegExp(`\\b${escapeRegExp(ability)}\\b`, "g");
          const abilityClass = ability === "Fury of Azzinoth" ? "log-ability-azzinoth" : "log-ability-rogue";
          output = output.replace(pattern, `<span class="${abilityClass}">$&</span>`);
        });
        warlockAbilities.forEach((ability) => {
          const pattern = new RegExp(`\\b${escapeRegExp(ability)}\\b`, "g");
          output = output.replace(pattern, `<span class="log-ability-warlock">$&</span>`);
        });
        druidAbilities.forEach((ability) => {
          let pattern;
          if (ability === "Wrath") {
            // Avoid partial overlap with Paladin "Avenging Wrath"
            pattern = /(?<!Avenging\s)\bWrath\b/g;
          } else {
            pattern = new RegExp(`\\b${escapeRegExp(ability)}\\b`, "g");
          }
          output = output.replace(pattern, `<span class="log-ability-druid">$&</span>`);
        });
        paladinAbilities.forEach((ability) => {
          const pattern = new RegExp(`\\b${escapeRegExp(ability)}\\b`, "g");
          output = output.replace(pattern, `<span class="log-ability-paladin">$&</span>`);
        });
        priestAbilities.forEach((ability) => {
          const pattern = new RegExp(`\\b${escapeRegExp(ability)}\\b`, "g");
          output = output.replace(pattern, `<span class="log-ability-priest">$&</span>`);
        });
        greenItems.forEach((item) => {
          const escapedItem = escapeRegExp(item).replace(/'/g, "(?:'|&#039;)");
          const pattern = new RegExp(`\\b${escapedItem}\\b`, "g");
          output = output.replace(pattern, `<span class="log-item-green">$&</span>`);
        });
        blueItems.forEach((item) => {
          const escapedItem = escapeRegExp(item).replace(/'/g, "(?:'|&#039;)");
          const pattern = new RegExp(`\\b${escapedItem}\\b`, "g");
          output = output.replace(pattern, `<span class="log-item-blue">$&</span>`);
        });
        purpleItems.forEach((item) => {
          const escapedItem = escapeRegExp(item).replace(/'/g, "(?:'|&#039;)");
          const pattern = new RegExp(`\\b${escapedItem}\\b`, "g");
          output = output.replace(pattern, `<span class="log-item-purple">$&</span>`);
        });
        orangeItems.forEach((item) => {
          const escapedItem = escapeRegExp(item).replace(/'/g, "(?:'|&#039;)");
          const pattern = new RegExp(`\\b${escapedItem}\\b`, "g");
          output = output.replace(pattern, `<span class="log-item-orange">$&</span>`);
        });

        return applyFxTokensToHtml(output, fxTokens);
      }

      function appendLine(msg, cls = "") {
        const line = document.createElement("div");
        const classes = ['log-line'];
        if (cls) {
          classes.push(cls);
        }
        if (msg.includes("HOT STREAK")) {
          classes.push("logLineProc");
        }
        if (msg.includes("Has Ambush!")) {
          classes.push("logLineAmbush");
        }
        if (msg.includes("Has Final Verdict Empowered!")) {
          classes.push("logLinePaladinProc");
        }
        if (msg.includes("Can Use Execute")) {
          classes.push("logLineExecute");
        }
        if (
          msg.includes("Has Shadowy Insight!")
          || msg.includes("Mind Blast is empowered!")
          || msg.includes("Shadow Word: Death Damage Doubled!")
        ) {
          classes.push("logLinePriestGlow");
        }
        if (msg.startsWith("Turn ")) {
          classes.push("logLineTurnHeader");
        }
        if (msg.includes("wins the duel") || msg.includes("Double KO")) {
          classes.push("logLineOutcome");
        }
        line.className = classes.join(" ");
        line.innerHTML = highlightLogLine(msg);
        logDiv.appendChild(line);
        initThunderfuryFx(line);
        initDragonwrathFx(line);
        initTwinBladesFx(line);
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function appendChatMessage(playerClass, message, isMe) {
        const msgDiv = document.createElement("div");
        msgDiv.className = isMe ? 'chat-message friendly' : 'chat-message enemy';
        
        const playerSpan = document.createElement("span");
        playerSpan.className = 'chat-player';
        playerSpan.textContent = playerClass + (isMe ? " (YOU):" : ":");
        
        const textSpan = document.createElement("span");
        textSpan.textContent = " " + message;
        
        msgDiv.appendChild(playerSpan);
        msgDiv.appendChild(textSpan);
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      socket.on("connect", () => {
        lastLogLength = 0;
        connDot.classList.add("connected");
        connText.textContent = "Connected";
        appendLine("⚔️ Connected to Arena Server", "logLineSystem");
      });

      socket.on("disconnect", () => {
        lastLogLength = 0;
        connDot.classList.remove("connected");
        connText.textContent = "Disconnected";
        roleText.textContent = "Awaiting Match";
        appendLine("❌ Disconnected from Arena Server", "logLineSystem");
      });

      socket.on("duel_system", (msg) => appendLine("🛡️ " + msg, "logLineSystem"));
      socket.on("duel_role", (role) => {
        myRole = role;
        roleText.textContent = role;
        appendLine("⚔️ You are " + role, "logLineSystem");
      });
      
      socket.on("duel_chat", (data) => {
        // data should have: playerClass, message, role
        const isMe = (data.role === myRole);
        appendChatMessage(data.playerClass, data.message, isMe);
      });
      socket.on("duel_prep_options", (data) => {
        if (data?.classes) {
          appendLine("📜 Classes: " + Object.keys(data.classes).join(", "), "logLineSystem");
        }
        if (data?.items) {
          appendLine("⚒️ Items: " + Object.keys(data.items).join(", "), "logLineSystem");
        }
        if (data?.abilities) {
          appendLine("✨ Abilities: " + Object.keys(data.abilities).join(", "), "logLineSystem");
        }
      });

      socket.on("duel_turn", (msg) => {
        appendLine(" ", "logLineTurn");
        msg.split("\n").forEach(line => appendLine(line, "logLineTurn"));
      });

      socket.on("duel_log", (msg) => appendLine(msg, "logLineTurn"));
      
      let lastLogLength = 0;

      function renderFriendlyCooldowns(cooldowns, abilityMeta) {
        if (!cooldownTracker) {
          return;
        }

        const entries = Object.entries(cooldowns || {})
          .filter(([, remainingTurns]) => Number(remainingTurns) > 0)
          .sort((a, b) => Number(b[1]) - Number(a[1]));

        cooldownTracker.innerHTML = "";

        if (!entries.length) {
          const emptyEl = document.createElement("div");
          emptyEl.className = "cooldown-empty";
          emptyEl.textContent = "No cooldowns active.";
          cooldownTracker.appendChild(emptyEl);
          return;
        }

        entries.forEach(([abilityId, remainingTurns]) => {
          const line = document.createElement("div");
          line.className = "cooldown-entry";
          const abilityName = abilityMeta?.[abilityId]?.name || abilityId;
          const turns = Number(remainingTurns);
          line.textContent = `${abilityName} — ${turns} ${turns === 1 ? "turn" : "turns"}`;
          cooldownTracker.appendChild(line);
        });
      }

      socket.on("duel_snapshot", (data) => {
        // Update class names
        if (data.you_class) {
          friendlyLabel.textContent = data.you_class;
        }
        if (data.enemy_class) {
          enemyLabel.textContent = data.enemy_class;
        }
        
        // Update equipped items
        if (data.you_items) {
          setItemLabel(friendlyWeapon, data.you_items.weapon);
          setItemLabel(friendlyArmor, data.you_items.armor);
          setItemLabel(friendlyTrinket, data.you_items.trinket);
        }
        if (data.enemy_items) {
          setItemLabel(enemyWeapon, data.enemy_items.weapon);
          setItemLabel(enemyArmor, data.enemy_items.armor);
          setItemLabel(enemyTrinket, data.enemy_items.trinket);
        }
        
      function primaryResourceFrom(res, resource) {
        if (!resource || !res) {
          return { value: 0, max: 0 };
        }
        const map = {
          mp: { value: res.mp, max: res.mp_max },
          rage: { value: res.rage, max: res.rage_max },
          energy: { value: res.energy, max: res.energy_max },
        };
        return map[resource.id] || { value: res.mp, max: res.mp_max };
      }

      function renderRes(res, elements, resource) {
        if (!res) {
          elements.hpText.textContent = "--";
          elements.hpBar.style.width = "0%";
          if (elements.absorbBar) {
            elements.absorbBar.style.width = "0%";
          }
          elements.primaryText.textContent = "--";
          elements.primaryBar.style.width = "0%";
          return;
        }
        
        const clampedHp = Math.max(0, Math.min(res.hp, res.hp_max));
        const hpPercent = res.hp_max ? (clampedHp / res.hp_max) * 100 : 0;
        const absorbValue = Math.max(0, res.absorb || 0);
        const absorbPercent = res.hp_max ? (absorbValue / res.hp_max) * 100 : 0;
        const absorbWidth = Math.min(absorbPercent, Math.max(0, 100 - hpPercent));
        const primaryResource = primaryResourceFrom(res, resource);
        const primaryPercent = primaryResource.max ? (primaryResource.value / primaryResource.max) * 100 : 0;
        
        elements.hpText.textContent = `${res.hp} / ${res.hp_max}`;
        const isDead = res.hp <= 0;
        elements.hpBar.classList.toggle("hp-dead", isDead);
        elements.hpBar.style.width = isDead ? "100%" : hpPercent + "%";
        if (elements.absorbBar) {
          elements.absorbBar.style.width = isDead ? "0%" : absorbWidth + "%";
        }
        elements.primaryText.textContent = `${primaryResource.value} / ${primaryResource.max}`;
        elements.primaryBar.style.width = primaryPercent + "%";
        elements.primaryLabel.textContent = resource.label || "Mana";
        elements.primaryLabel.style.color = resource.color || "var(--mana-blue)";
        elements.primaryBar.style.backgroundColor = resource.color || "var(--mana-blue)";
      }

      function classKeyFromLabel(label) {
        if (!label) {
          return "";
        }
        return label.replace(" (YOU)", "").trim().toLowerCase();
      }

      function setStatusClass(element, classKey) {
        if (!element) {
          return;
        }
        element.classList.remove("warrior", "mage", "rogue", "druid", "warlock", "paladin", "priest");
        if (classKey) {
          element.classList.add(classKey);
        }
      }

      function renderStatus(stealthed, formId, classKey, element) {
        if (!element) return;
        const formMap = {
          bear_form: "Bear Form",
          cat_form: "Cat Form",
          moonkin_form: "Moonkin Form",
          tree_form: "Tree Form",
        };
        if (stealthed) {
          setStatusClass(element, classKey);
          element.textContent = "Stealthed";
          element.classList.add("stealthed");
          return;
        }
        const formLabel = formMap[formId];
        if (formLabel) {
          setStatusClass(element, classKey);
          element.textContent = formLabel;
          element.classList.remove("stealthed");
          return;
        }
        setStatusClass(element, "");
        element.textContent = "--";
        element.classList.remove("stealthed");
      }
      
        renderRes(data.you, {
          hpText: friendlyHpText,
          hpBar: friendlyHpBar,
          absorbBar: friendlyAbsorbBar,
          primaryText: friendlyPrimaryText,
          primaryBar: friendlyPrimaryBar,
          primaryLabel: friendlyPrimaryLabel,
        }, data.you_resource || { id: "mp", label: "Mana", color: "var(--mana-blue)" });
        renderStatus(
          Boolean(data.you_stealthed),
          data.you_form,
          classKeyFromLabel(data.you_class),
          friendlyStatus
        );
        
        renderRes(data.enemy, {
          hpText: enemyHpText,
          hpBar: enemyHpBar,
          absorbBar: enemyAbsorbBar,
          primaryText: enemyPrimaryText,
          primaryBar: enemyPrimaryBar,
          primaryLabel: enemyPrimaryLabel,
        }, data.enemy_resource || { id: "mp", label: "Mana", color: "var(--mana-blue)" });
        renderStatus(
          Boolean(data.enemy_stealthed),
          data.enemy_form,
          classKeyFromLabel(data.enemy_class),
          enemyStatus
        );

        renderFriendlyCooldowns(data.friendly_cooldowns, data.ability_meta);
        
        if (data.log) {
          const total = data.log_length ?? data.log.length;
          const newCount = Math.max(total - lastLogLength, 0);
          const sliceStart = data.log.length - newCount;
          data.log.slice(sliceStart).forEach(line => appendLine(line, "logLineTurn"));
          lastLogLength = total;
        }
        
        if (data.phase === "ended") {
          appendLine("🏆 DUEL ENDED!", "logLineSystem");
        }

        lockBtn.disabled = data.phase !== "prep";
      });

      function sendCommand() {
        const text = cmdInput.value.trim();
        if (!text) return;

        if (text.toLowerCase().startsWith("/class")) {
          const parts = text.split(/\s+/);
          const classId = (parts[1] || "").toLowerCase();
          socket.emit("duel_prep_submit", { class_id: classId });
        } else if (text.toLowerCase().startsWith("/item")) {
          const parts = text.split(/\s+/);
          const slot = parts[1] || "";
          const itemId = parts[2] || "";
          if (slot && itemId) {
            socket.emit("duel_prep_submit", { items: { [slot]: itemId } });
          }
        } else {
          socket.emit("duel_action", { ability_id: text.toLowerCase() });
        }

        cmdInput.value = "";
      }

      function sendChat() {
        const text = chatInput.value.trim();
        if (!text) return;
        
        socket.emit("duel_chat", text);
        chatInput.value = "";
      }

      sendBtn.addEventListener("click", sendCommand);
      cmdInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          sendCommand();
        }
      });

      chatSendBtn.addEventListener("click", sendChat);
      chatInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          sendChat();
        }
      });

      queueBtn.addEventListener("click", () => socket.emit("duel_queue"));
      lockBtn.addEventListener("click", () => socket.emit("duel_lock_in"));
      passBtn.addEventListener("click", () => socket.emit("duel_action", { ability_id: "pass_turn" }));
    </script>
  </body>
</html>
